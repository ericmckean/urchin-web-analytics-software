## Please edit system and help pages ONLY in the moinmaster wiki! For more
## information, please see MoinMaster:MoinPagesEditorGroup.
##acl MoinPagesEditorGroup:read,write,delete,revert All:read
##master-page:HelpTemplate
##master-date:Unknown-Date
#format wiki
#language en
'''Быстрая установка UTM (Apache)'''

''Статья предоставлена компанией'' ["Panalysis"]'', авторизованным консультантом по программному обеспечению Urchin ''

Ниже вкратце описывается, как установить UTM для веб-сайтов, работающих на базе сервера Apache (вне зависимости от используемой платформы).

'''Шаг 1. Скопируйте файлы UTM в корневой каталог документов веб-сайта.''' Файлы urchin.js и `__`utm.gif находятся в каталоге "util/utm" дистрибутива Urchin. Скопируйте эти файлы в основной каталог документов своего веб-сайта.

'''Шаг 2. Пропишите UTM в HTML-коде своего сайта.''' В HTML-коде каждой страницы добавьте указанную ниже строку. Расположение этой строки не имеет значения, но мы рекомендуем поместить ее в раздел 

&lt;head&gt;

. Если вы используете обычное включение или шаблон, код можно вставить в него. ВАЖНО! Название файла GIF начинается с двух знаков подчеркивания.

```
<script src="/urchin.js" type="text/javascript"></script>
<script type="text/javascript">
        urchinTracker();
</script>
```
Если используется пакет типа "HTML Tidy", можно добавить строку Javascript в раздел HEAD. Пример:

```
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <script src="/urchin.js" type="text/javascript"></script>
  <script type="text/javascript">
        urchinTracker();
  </script>
  ...
</head>
```
'''Шаг 3. Разрешите добавление файлов cookie в журнал Apache.'''  На примере файла httpd.conf показано, как это сделать:

```
LogFormat "%h %v %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" \"%{Cookie}i\"" urchin
...
<VirtualHost 63.212.171.6>
ServerName www.mysite.com
DocumentRoot /www/www.mysite.com
CustomLog /var/logs/mysite.log urchin
</VirtualHost>
```
'''Шаг 4. В профиле Urchin включите использование UTM.''' В интерфейсе администрирования Urchin измените соответствующий профиль и перейдите на вкладку "Отчеты". В разделе "Метод отслеживания посетителей" выберите UTM. В поле "Домен UTM" введите адрес своего веб-сайта (без префикса www). После этого нажмите кнопку "Обновить". Затем перейдите на вкладку "Настройки профиля" и для параметра "Набор отчетов по умолчанию" выберите "Все с поддержкой UTM". Снова нажмите "Обновить". Вот и всё! Теперь ваш веб-сайт начнет записывать данные UTM в стандартный файл журнала, идентификация которого будет выполнена при следующем запуске Urchin.

'''Убедитесь, что все работает правильно.''' Чтобы узнать, регистрируются ли данные UTM в файл журнала, нужно открыть его после установки UTM и просмотра нескольких страниц сайта. В конце файла журнала должна появиться запись, которая будет выглядеть примерно так:

```
... "GET /__utm.gif?..." 200 ..."__utma=..."
```
Если записи `__`utma не появляются, убедитесь, что запись файлов cookie в журнал включена правильно. Если код статуса не равен 200, проверьте, скопированы ли файлы в корневой каталог документов сайта.

{{{}}}