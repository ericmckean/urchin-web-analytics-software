<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>記錄 - Apache 與 IIS</strong> <p class="line867"><strong>總覽</strong> <p class="line874">以 Urchin 能恰當轉譯資料並產出完整詳細報告的格式來設定您的網頁伺服器記錄，是非常重要的。本文將說明常見網頁伺服器、Apache 與 Microsoft IIS 的設定程序。若要取得最深入的報告，啟用包含「推薦連結」及「使用者代理程式」資訊的記錄十分重要。若要在使用「Urchin 追蹤模組 (UTM)」時啟用特定訪客報告，還需另外啟用 Cookie 記錄。以 UTM 為基礎的追蹤是取得真實特定訪客報告的唯一途徑。雖然並非必要，但我們建議您在變更網頁伺服器記錄之前，先決定是否使用 UTM。若決定使用，應立即在記錄中啟用 Cookie。如果您啟用 Cookie 但沒有立即在網站上安裝 UTM，亦無傷大雅。操作之前，建議您詳讀「訪客追蹤」一節，以熟悉 UTM 安裝程序。 <p class="line867"><strong>組態</strong> <p class="line867"><strong>Apache</strong> <p class="line874">按照預設，Apache 通常會以常用的記錄格式進行記錄，也會提供選項供使用者以較為詳細的格式記錄 (稱為 NCSA 延伸 / 結合記錄格式)。若需最佳報告內容，Urchin 需要 NCSA 延伸 / 結合格式的變化。若要設定 Apache 以使用恰當的格式，請按照下列方式進行： <p class="line874">1. 建立 httpd.conf 檔案的備份。然後用文字編輯器開啟原始的 httpd.conf。 <p class="line862">2. 找到包含以 LogFormat 開頭行的程式碼片段。 <p class="line862">3. 使用以下顯示的其中一種表單插入新的 LogFormat 行，使用哪一種表單則取決於您是否要使用 UTM。LogFormat 項目必須以單一行的形式新增至您的組態檔，但不可包含換行字元或分行符號。請務必小心，以正確輸入所有字元。 <p class="line867"><strong>針對不使用 UTM 的網站：</strong> <p class="line867"><tt>LogFormat&nbsp;"%h&nbsp;%v&nbsp;%u&nbsp;%t&nbsp;\"%r\"&nbsp;%&gt;s&nbsp;%b&nbsp;\"%{Referer}i\"&nbsp;\"%{User-Agent}i\""&nbsp;urchin</tt> <p class="line867"><strong>針對啟用 UTM 的網站：</strong> <p class="line867"><tt>LogFormat&nbsp;"%h&nbsp;%v&nbsp;%u&nbsp;%t&nbsp;\"%r\"&nbsp;%&gt;s&nbsp;%b&nbsp;\"%{Referer}i\"&nbsp;\"%{User-Agent}i\"&nbsp;\"%{Cookie}i\""&nbsp;urchin</tt> <p class="line862">4. LogFormat 行結尾的「urchin」字詞是您會用於 httpd.conf 內其他位置的暱稱，以便將此格式套用至記錄檔。此字串您可以任選。使用「urchin」有助您辨識為了因應 Urchin 處理程序而建立的項目。 <p class="line862">5. 請檢查您希望啟用新記錄格式的 &lt;VirtualHost&gt; 項目。停用 &lt;VirtualHost&gt;&lt;/VirtualHost&gt; 群組中任何現有的 TransferLog 或 CustomLog 項目，在項目前方插入 # 即可停用 (例如：將 TransferLog 改成 #TransferLog)。然後插入以下的 CustomLog 新項目，請用指向記錄位置的恰當路徑取代記錄 path_to_log 字串。 <p class="line867"><tt>CustomLog&nbsp;path_to_log/access.log&nbsp;urchin</tt> <p class="line862">如果您先前選擇「urchin」之外的識別碼做為 LogFormat 項目的暱稱，請用該暱稱取代 CustomLog 項目內的「urchin」。 <p class="line874">6. 將編輯內容儲存至您的 httpd.conf 檔案。 <p class="line862">7. <strong>重要！</strong> 執行以下指令來檢查新 httpd.conf 的語法： <p class="line867"><tt>apachectl&nbsp;configtest</tt> <p class="line874">這樣做應該會產生「語法正確」的回應：「ok」。如果沒有出現該回應，請仔細檢查 httpd.conf 檔案並修正錯誤。如果無法取得正確回應，請勿繼續進行程序。此時請建立已編輯檔案的備份，然後用您於程序初始時儲存的 httpd.conf 副本覆寫目前的版本，以復原原始檔案。這樣做能確保網頁伺服器繼續正常運作，直到您進行各項變更並找出錯誤為止。 <p class="line874">8. 確認 httpd.conf 的語法後，請重新啟動 Apache。偏好的方法是呼叫 apachectl 指令碼，該指令碼通常與 Apache 一併安裝。 <p class="line867"><tt>apachectl&nbsp;restart</tt> <p class="line862">9. 檢查記錄。開啟瀏覽器並點擊相關網站數次。然後檢查 CustomLog 項目中指定記錄檔的最後幾行。您應該會看見幾個最近的點擊已經寫入記錄。 <p class="line874">針對 Urchin 修改的延伸 / 結合記錄格式，記錄行大致如下： <p class="line867"><tt class="backtick">64.40.51.27</tt> <tt class="backtick">www.urchin.com</tt> <tt class="backtick">-</tt> <tt class="backtick">[28/Aug/2002:15:11:01</tt> <tt class="backtick">-0700]</tt> <tt class="backtick">"GET</tt> <tt class="backtick">/images/urchin_header_logo.gif</tt> <tt class="backtick">HTTP/1.1"</tt> <tt class="backtick">200</tt> <tt class="backtick">3017</tt> <tt class="backtick">"http://www.urchin.com/"</tt> <tt class="backtick">"Mozilla/4.0</tt> <tt class="backtick">(compatible;</tt> <tt class="backtick">MSIE</tt> <tt class="backtick">6.0;</tt> <tt class="backtick">Windows</tt> <tt class="backtick">NT</tt> <tt class="backtick">5.0)"</tt> <p class="line874">如果您的網站上已經設定 UTM 並開啟 Cookie 記錄，則記錄行大致如下： <p class="line867"><tt class="backtick">64.40.51.27</tt> <tt class="backtick">www.urchin.com</tt> <tt class="backtick">-</tt> <tt class="backtick">[28/Aug/2002:15:11:01</tt> <tt class="backtick">-0700]</tt> <tt class="backtick">"GET</tt> <tt class="backtick">/images/urchin_header_logo.gif</tt> <tt class="backtick">HTTP/1.1"</tt> <tt class="backtick">200</tt> <tt class="backtick">3017</tt> <tt class="backtick">"http://www.urchin.com/"</tt> <tt class="backtick">"Mozilla/4.0</tt> <tt class="backtick">compatible;</tt> <tt class="backtick">MSIE</tt> <tt class="backtick">6.0;</tt> <tt class="backtick">Windows</tt> <tt class="backtick">NT</tt> <tt class="backtick">5.0)"</tt> <tt class="backtick">"__utma=171060324.1378004559.1063331913.1063334677.1063521838.3;</tt> <tt class="backtick">__utmb=171060324;</tt> <tt class="backtick">__utmc=171060324"</tt> <p class="line874">10. 請注意行結尾的額外 UTM Cookie 資訊。 <p class="line867"><strong>Microsoft 網際網路資訊伺服器 (IIS)</strong> <p class="line874">請注意：Microsoft IIS 使用 W3C 記錄格式。 <p class="line874">如果您的 IIS 記錄檔至少包含以下欄位，則 Urchin 可以提供非常基本的報告： <ul><li>日期 </li><li>時間 </li><li>C-IP </li><li>CS-URI-Stem </li><li>SC-Status </li><li>SC-Bytes </li></ul><p class="line874">這些是必填欄位。若沒有這些欄位，您就無法取得有意義的報告。但是，最陽春的記錄無法提供「推薦連結」與「瀏覽器」報告的足夠資訊。因此，建議您為 IIS 伺服器設定更詳細的記錄內容。 <p class="line874">IIS 記錄內容可針對伺服器上的各網域分別設定，或一併設定所有網域。針對網域量較大的伺服器，建議您採用一併設定選項。下列步驟能確保記錄必填的記錄檔欄位。如果您選擇記錄額外欄位，Urchin 處理時會直接略過。但是，記錄不必要的欄位會增加記錄檔的大小，因此最好只記錄 Urchin 所需的欄位。 <p class="line862">1. 若要啟用 IIS 服務管理工具，請前往 [開始] &gt; [程式集] &gt; [管理工具] &gt; [電腦管理]。 <p class="line874">2. 展開 [服務及應用程式] 樹，然後選取 [網際網路資訊服務] 即會出現網站清單 (Windows 2003 伺服器除外，使用此版本時您需再展開 [網站] 資料夾，才能取得網站列表)。 <p class="line874">3. 用滑鼠右鍵按一下您想要調整的網站項目，然後選取 [內容]。 <p class="line874">4. 選取 [網站] 標籤，並確認本頁底部的 [啟用記錄] 核取方塊確實已經勾選。接著，請從「啟用記錄格式」下拉式選單中，選擇 [W3C 延伸記錄檔格式]。 <p class="line874">5. 按一下「啟用記錄格式」方塊旁的 [內容]。 <p class="line874">6. 選取 [延伸內容] 標籤。 <p class="line874">7. 請勾選下列欄位方塊： <ul><li>日期 [ date] </li><li>時間 [ time ] </li><li>客戶 IP 位址 [ c-ip ] </li><li>使用者名稱 [ cs-username ] </li><li>方式 [ cs-method ] </li><li>URI Stem [ cs-uri-stem ] </li><li>URI 查詢 [ cs-uri-query ] </li><li>通訊協定狀態 [ sc-status ] </li><li>已傳送位元組 [ sc-bytes ] </li><li>使用者代理程式 [ cs[User-Agent] ] </li><li>推薦連結 [ cs[Referer] ] </li><li>Cookie [ cs[Cookie] ] (僅 UTM 追蹤需要此欄位) </li></ul><p class="line874">8. 您應確認 [處理帳戶] 方塊並未勾選，因為其無法提供實用的網頁存取活動資訊。 <p class="line874">9. 在各視窗中選取 [Apply] 與 [確定]，以儲存您的設定。 <p class="line874">10. 無須重新啟動 IIS。記錄檔應該會根據新的設定，立即開始記錄。 </div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>