<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>如何處理錯誤「(7054-323-317) 沒有備份資料，因此無法還原資料庫」？</strong> <p class="line867"><strong>問題描述</strong> <p class="line874">執行 Urchin 設定檔時出現下列訊息： <p class="line874">(7050-323-317) Starting automatic rollback + <p class="line874">(7054-323 317) Unable to restore databases since backup does not exist. <p class="line867"><strong>原因</strong> <p class="line874">如果上一次執行此 Urchin 設定檔時異常終止，就可能會出現這個錯誤。如果「記錄處理引擎」的程序 / 工作是由系統管理員透過控制台 CLI 等手動終止，或發生其他非預期的問題而終止了正在進行的記錄處理程序，或是未正確完成系統重新開機的程序，都有可能會發生這種情況。 <p class="line874">一般來說，Urchin 能夠將設定檔復原為最後已知的正常狀態，以順利修復異常終止的狀況；不過，要是在第一次執行 (或當月第一次執行) 設定檔時處理程序遭到終止，便沒有可以復原的備份檔案。這個時候，Urchin 會顯示「無法還原資料庫」錯誤。 <p class="line874">從更深的技術面來看，Urchin 記錄處理引擎會在報告目錄中為正在處理的設定檔建立 lock.udb 檔案，並在處理期間鎖定此檔案，以確保在同一時間內，只有一個記錄處理引擎會處理該設定檔。記錄處理引擎會在啟動時檢查 lock.udb 檔案是否存在。如果該檔案存在，記錄處理引擎便會檢查最近的鎖定。如果找不到任何鎖定，代表上一次設定檔執行失敗，因此記錄處理引擎便會嘗試將設定檔的資料庫復原為處理前的最後已知正常狀態。如上所述，如果復原封存不存在，便會顯示復原錯誤訊息並終止記錄處理的程序。 <p class="line867"><strong>補救方法</strong> <p class="line874">由於 Urchin 在上一次執行時異常終止，因此當月處理中的 Urchin 資料庫仍處於未知狀態，所包含的資料也沒有設定正確的檢查點。所以整個月的處理中資料都必須移除。在大部分情況下，當月的 Urchin 資料只會包含那些處理失敗時所建立的資料，因此不必擔心移除了重要資料。 <p class="line874">請按照下列程序重設 Urchin 設定檔資料，以便繼續執行設定檔： <p class="line867"><span class="u">Windows Systems</span> <ol type="1"><li><p class="line862">開啟 DOS Shell ([開始] -&gt; [執行] -&gt; [cmd]) </li><li>將目錄變更為儲存 Urchin 設定檔資料的資料夾，通常是： <ul><li style="list-style-type:none">C:\Program Files\Urchin\data\reports\profilename </li></ul></li><li>使用 "TYPE lock.udb" 指令檢視 lock.udb 檔案的內容。其中有一兩行會包含 YYYYMM 日期項目，例如 200408。 </li><li>針對 lock.udb 檔案中的每一行 YYYYMM，執行下列步驟： <ul><li>使用 DEL YYYYMM-*data* 指令移除對應的每月 Urchin 資料庫 </li><li>使用 DIR YYYYMM*backup*.zip 指令檢查是否存在對應月份的備份封存。備份封存會命名為 YYYYMM-backup-YYYYMMDDHHMMSS.zip，例如 200805-backup-20080331103340.zip。 </li><li>如果該月有一個或多個備份檔案，則使用 "..\..\..\util\unzip -o -u backupfile.zip" 指令，從時間戳記最接近的備份封存還原資料，例如 ..\..\..\util\unzip -o -u 200805-backup-20080331103340.zip </li></ul></li><li>使用 DEL lock.udb 指令移除 lock.udb 檔案 </li><li>您現在可以使用 [立即執行] 按鈕再次執行設定檔了 </li></ol><p class="line867"><span class="u">UNIX 類型系統</span> <ol type="1"><li>以「根權限」或 Urchin 執行使用者的身分開啟指令殼層 </li><li>將目錄變更為儲存 Urchin 設定檔資料的位置，例如： <ul><li style="list-style-type:none">"cd /usr/local/urchin/data/reports/profilename" </li></ul></li><li>使用 "cat lock.udb" 指令檢視 lock.udb 檔案的內容。其中有一兩行會包含 YYYYMM 日期項目，例如 200803。 </li><li>針對 lock.udb 中的每一行 YYYYMM，執行下列步驟： <ul><li>使用 rm YYYYMM-*data* 指令移除對應的每月 Urchin 資料庫 </li><li>使用下列指令檢查是否存在對應月份的備份封存： <ul><li style="list-style-type:none">"ls YYYYMM*backup*.zip"。備份封存會命名為 YYYYMM-backup-YYYYMMDDHHMMSS.zip，例如 200803-backup-20080331103340.zip。 </li></ul></li><li>如果該月有一個或多個備份檔案，則使用 "../../../util/unzip -o -u backupfile.zip" 指令，從時間戳記最接近的備份封存還原資料，例如 "../../../util/unzip -o -u 200803-backup-20080331103340.zip" </li></ul></li><li>使用「rm lock.udb」指令移除 lock.udb 檔案 </li><li>您現在可以使用 [立即執行] 按鈕再次執行設定檔了 </li></ol></div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>