<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>Urchin 6 - Guide d'installation (FreeBSD et Linux)</strong> <ul><li style="list-style-type:none"><p class="line891"><em>Cet article a été rédigé par </em> <a href="EpikOne.html">EpikOne</a><em>, un consultant agréé Urchin </em> </li></ul><p class="line867"><strong>Avant de commencer - Remarque importante destinée aux utilisateurs d'Urchin 6.500</strong> <p class="line862">Plusieurs problèmes avaient été identifiés au niveau du planificateur de CPC dans Urchin 6.501. Si vous effectuez une mise à niveau à partir d'Urchin 6.601, les données CPC traitées pouvaient être incorrectes ou incomplètes, ce qui entraînait des erreurs dans les rapports Urchin. Pour faire en sorte que les données issues de Google AdWords soient correctes, nous vous conseillons soit (a) d'installer Urchin 6.601 dans un nouvel emplacement, soit (b) de supprimer les anciennes données CPC si vous souhaitez effectuer l'installation en gardant l'instance 6.500. Si vous optez pour la seconde solution, supprimez tous les éléments contenus dans les répertoires suivants : <p class="line867"><pre>&lt;chemin_d'accès_à_l'installation_urchin_6500&gt;/data/cpc/...
&lt;chemin_d'accès_à_l'installation_urchin_6500&gt;/history/cpc/...
</pre><p class="line874">Aucune action n'est exigée de votre part si vous effectuez une mise à niveau à partir d'Urchin 6.600, 6.501 ou 6.402, ou toute version antérieure. <p class="line867"><strong>Avant de commencer - Remarque importante destinée aux utilisateurs de FreeBSD</strong> <ul><li>FreeBSD dispose d'une limite (figée dans le code) de taille de données de processus de 500 Mo, ce qui n'est pas suffisant pour permettre à Urchin de s'exécuter du fait de la taille des données géographiques Urchin qui doivent rester en mémoire pendant le traitement du journal. Le message d'erreur qui s'affiche lors de l'exécution est le suivant : </li></ul><p class="line867"><pre>ERREUR : (8011-323-1057) Échec d'allocation de la mémoire
</pre><ul><li style="list-style-type:none">Pour régler ce problème, vous devez augmenter la taille des données de processus par défaut du système FreeBSD en modifiant le fichier /boot/loader.conf et en ajoutant ces lignes : </li></ul><p class="line867"><pre># Increase max process data segment size to 1GB
kern.maxdsiz="1073741824"
</pre><ul><li style="list-style-type:none">Un redémarrage est nécessaire après cette opération. </li><li>FreeBSD utilise un pilote spécial appelé accf_http. Celui-ci met en tampon les connexions entrantes jusqu'à ce qu'un certain nombre de demandes HTTP arrivent pour accélérer et optimiser les performances. Par défaut, ce pilote n'est pas chargé dans le noyau et l'avertissement suivant s'affichera : </li></ul><p class="line867"><pre>[warn] (2)Fichier ou répertoire introuvable : impossible d'activer le filtre Accept "httpready".
</pre><ul><li style="list-style-type:none">Pour régler ce problème, vous devez activer le module de noyau FreeBSD du filtre HTTP Accept en modifiant le fichier /boot/loader.conf et en ajoutant ces lignes : </li></ul><p class="line867"><pre># Wait for full HTTP request accept filter
accf_http_load="YES"
</pre><ul><li style="list-style-type:none">Un redémarrage est nécessaire après cette opération. </li></ul><p class="line867"><strong>AVERTISSEMENT !!!</strong> Soyez très vigilant lorsque vous modifiez ces limites système. Si vous définissez  une taille trop importante pour kern.maxdsiz, votre système risque de ne pas pouvoir redémarrer. Nous vous <strong>recommandons vivement</strong> de consulter la documentation FreeBSD avant d'apporter des modifications et d'évaluer les risques potentiels s'appliquant à la configuration spécifique de votre site. <p class="line867"><strong>Présentation de la procédure d'installation</strong> <ul><li>Installation du serveur de base de données voulu sur le système Urchin ou ajout de la base de données Urchin à un serveur existant. Moteurs de base de données actuellement pris en charge : <ul><li>MySQL 5.0.3 ou versions ultérieures (Remarque : À partir de la version Urchin 6.6, MySQL 4.x.x n'est plus pris en charge) </li><li>PostgreSQL 8.2.5 ou versions ultérieures </li></ul></li><li>Création de la base de données Urchin et de l'utilisateur sur le serveur de la base de données et octroi des autorisations d'accès </li><li>Extraction de la distribution Urchin dans un répertoire temporaire </li><li>Exécution du script install.sh </li><li>Obtention de la licence d'installation Urchin </li></ul><p class="line867"><strong>Option 1 : Utilisation de MySQL avec Urchin</strong> <ul><li><p class="line862">Si aucun serveur MySQL n'est configuré sur votre système, vous pouvez obtenir une distribution à la page <a class="http" href="http://dev.mysql.com/downloads/">http://dev.mysql.com/downloads/</a>. </li><li>Installez le serveur MySQL en respectant les instructions présentées sur le site MySQL. </li></ul><p class="line874">. <ul><li>Assurez-vous de connaître les informations de connexion (par exemple, root) et le mot de passe de l'administrateur de base de données MySQL. </li></ul><p class="line874">. <ul><li>Sélectionnez le nom de la base de données, l'utilisateur MySQL local et le mot de passe que vous utiliserez avec Urchin. Enregistrez ces informations. En effet, vous en aurez besoin lors de l'installation d'Urchin. L'exemple ci-dessous illustre la création d'une base de données appelée urchin, avec le nom d'utilisateur MySQL urchin et le mot de passe urchinpassword (bien évidemment, vous devez choisir votre propre mot de passe !). </li></ul><p class="line874">. <ul><li>Créez la base de données Urchin, l'utilisateur et les autorisations à l'aide des commandes suivantes : </li></ul><p class="line867"><pre>root@yourserver# mysql -u root -p
mysql&gt; create database urchin character set utf8;
mysql&gt; GRANT ALL ON urchin.* to 'urchin'@'localhost' IDENTIFIED BY 'urchinpassword';
</pre><ul><li>Définissez le nom du chemin de la socket MySQL pour communiquer avec votre serveur MySQL. Vous le trouverez généralement dans le fichier my.cnf correspondant à votre installation MySQL. Consultez la ligne qui ressemble à : socket=/var/lib/mysql/mysql.sock. </li></ul><p class="line867"><strong>Option 2 : Utilisation de PostgreSQL avec Urchin</strong> <ul><li><p class="line862">Si aucun serveur PostgreSQL n'est configuré sur votre système, vous pouvez obtenir une distribution sur le site <a class="http" href="http://www.postgresql.org">http://www.postgresql.org</a>. </li><li>Installez le serveur PostgreSQL en respectant les instructions présentées sur le site PostgreSQL. </li><li>Assurez-vous que la commande psql est indiquée dans votre chemin et que vous connaissez les informations de connexion (par exemple, pgsql) et le mot de passe de l'administrateur de base de données PostgreSQL. </li><li>Sélectionnez le nom de la base de données, l'utilisateur PostgreSQL local et le mot de passe que vous utiliserez avec Urchin. Enregistrez ces informations. En effet, vous en aurez besoin lors de l'installation d'Urchin. L'exemple ci-dessous illustre la création d'une base de données appelée urchin avec le nom d'utilisateur PostgreSQL urchin et le mot de passe urchinpass (bien évidemment, vous devez choisir votre propre mot de passe !). </li><li>Créez la base de données Urchin, l'utilisateur et les autorisations à l'aide des commandes suivantes : </li></ul><p class="line867"><pre>root@yourserver# psql -U pgsql -d postgres
postgres=# CREATE DATABASE urchin WITH ENCODING 'UTF8';
postgres=# CREATE USER urchin WITH PASSWORD 'urchinpass';
postgres=# GRANT ALL ON DATABASE urchin TO urchin;
postgres=# \connect urchin;
postgres=# CREATE LANGUAGE 'PLPGSQL';
</pre><p class="line867"><strong>Installation d'Urchin</strong> <ul><li>Assurez-vous de disposer du nom de la base de données, de l'utilisateur et du mot de passe que vous avez sélectionnés ci-dessus. </li><li>Créez un répertoire temporaire afin d'y extraire la distribution Urchin : </li></ul><p class="line867"><pre>mkdir /var/tmp/urchintemp
cd /var/tmp/urchintemp
tar xzvf urchin6601_&lt;plate-forme&gt;_installer.tar.gz
</pre><p class="line867"><strong>Important !</strong> Pour garantir une installation correcte, vérifiez qu'aucune instance active d'Urchin 6 n'est présente sur la machine cible. Désactivez toute version d'Urchin 6 déjà présente via la commande suivante : <p class="line867"><pre>/path/to/urchin6/bin/urchinctl stop
</pre><ul><li>Si vous devez exécuter plusieurs instances d'Urchin 6 sur la même machine, ces instances doivent (1) être installées à des emplacements différents, (2) avoir des ports serveur différents et (3) être reliées à des bases de données différentes. </li><li>Urchin copie tous les fichiers nécessaires dans les dossiers cibles et écrase tous les fichiers existants. Afin de conserver les éventuels éléments personnalisés, vous devrez installer Urchin 6 dans un nouveau répertoire ou renommer le répertoire d'installation existant. </li><li>Urchin 6.601 peut être soit installé intégralement, soit mis à niveau depuis une version existante d'Urchin 6. <ul><li>Lors d'une nouvelle installation, Urchin invite l'utilisateur à indiquer tous les paramètres de configuration, tels que le port du serveur Web, les paramètres de configuration de la base de données, etc. Lors de la mise à niveau, Urchin réutilise la configuration de l'instance Urchin 6 existante. </li><li>Urchin 6.601 peut uniquement être utilisée pour la mise à niveau d'une version précédente bien particulière d'Urchin 6. Les versions ci-dessous peuvent être mises à niveau : <ul><li>Urchin 6.6 - Version anglaise       : Version 6.600 </li><li>Urchin 6.5 - Service Pack 2            :   Version 6.501 </li><li>Urchin 6.5                             :   Version 6.500 (voir la remarque importante ci-dessus) </li><li>Urchin 6 - Service Pack 1         :   Version 6.402 </li><li>Urchin 6 - Version internationale :   Version 6.401 </li><li>Urchin 6 - Version anglaise         :   Version 6.400 </li></ul></li><li>Lors d'une nouvelle installation, Urchin vous invite à initialiser les tables de la base de données. Si vous souhaitez conserver la configuration existante de la base de données, choisissez "Non".  Dans ce cas, même si Urchin conserve la configuration précédente (en ne recréant pas les tables existantes), il est possible qu'il doive créer des tables supplémentaires ou des colonnes dans les tables existantes. </li></ul></li><li>Exécutez maintenant le programme d'installation Urchin. Vous pouvez l'exécuter de façon interactive et répondre aux invites en tapant : </li></ul><p class="line867"><pre>./install.sh
</pre><p class="line874">ou effectuer une installation complète directement à partir de la ligne de commande, en fournissant vous-même tous les paramètres nécessaires à l'installation. Vous pouvez obtenir la liste des paramètres de ligne de commande en tapant : <p class="line867"><pre>./install.sh -h
</pre><ul><li>Une fois la procédure d'installation terminée, vous disposerez d'une version opérationnelle d'Urchin sur votre système. Pour terminer la configuration, indiquez l'URL suivante dans votre navigateur de prédilection : </li></ul><p class="line867"><pre>http://votreserveur:&lt;port&gt;
</pre><p class="line862">dans laquelle &lt;port&gt; correspond au port réseau que vous avez choisi au cours de l'installation (le paramètre par défaut est 9999). <ul><li>Si vous souhaitez rétablir vos données de rapports sur les profils à partir d'une version antérieure d'Urchin 6, copiez l'historique, les rapports et tous les répertoires CPC de /path/to/old-urchin6/data/ vers votre nouveau répertoire /path/to/new-urchin6/data/. </li><li>Cliquez sur le lien "Obtenir une licence de démo" et suivez la procédure d'obtention de licence permettant d'activer Urchin et de lancer la configuration. </li></ul><p class="line867"><strong>Configuration du suivi</strong> <p class="line874">Une fois Urchin installé, la configuration du suivi sur votre site Web peut requérir des étapes supplémentaires,  en fonction de l'utilisation envisagée. <p class="line867"><strong>Cas 1 : Utilisation d'Urchin avec la méthode de suivi IP+User-Agent</strong> <p class="line874">Aucune procédure de configuration supplémentaire n'est nécessaire. Lorsque vous ajoutez des profils dans Urchin, assurez-vous de spécifier IP+User-Agent comme méthode de suivi des visiteurs. <p class="line867"><strong>Cas 2 : Utilisation d'Urchin avec la méthode de suivi UTM</strong> <p class="line862">Pour utiliser Urchin avec la méthode de suivi UTM, vous devez installer un court extrait de code de suivi JavaScript sur chacune des pages de votre site Web. Voici la procédure à suivre : <ul><li><p class="line862">Copiez les fichiers urchin.js et <tt class="backtick">__</tt>utm.gif, à partir du répertoire util/utm de la distribution Urchin, vers la racine de votre site Web (par exemple dans le répertoire principal de votre contenu). </li></ul><p class="line874">. <ul><li>Sur chaque page de votre site Web, placez le code de suivi ci-après à la suite de toute balise META de la section HEAD : </li></ul><p class="line867"><pre>&lt;script src="/urchin.js" type="text/JavaScript"&gt;
&lt;/script&gt;
&lt;script type="text/JavaScript"&gt;
  _userv=0;
  urchinTracker();
&lt;/script&gt;
</pre><ul><li>Lorsque vous ajoutez des profils dans Urchin, assurez-vous de spécifier Urchin Traffic Monitor (UTM) comme méthode de suivi des visiteurs. </li></ul><p class="line867"><strong>Cas 3 : Utilisation d'Urchin parallèlement à Google Analytics</strong> <p class="line874">Veuillez noter que les nouvelles fonctionnalités de suivi du code Google Analytics "ga.js" ne sont pas compatibles avec les anciennes versions d'Urchin 6. Si vous souhaitez utiliser simultanément le logiciel Urchin et Google Analytics pour assurer le suivi de votre site Web, vous devrez continuer à utiliser le code de suivi urchin.js, comme illustré ci-dessous pour un fonctionnement optimal. Si vous choisissez d'utiliser ga.js, vous n'aurez pas accès aux nouvelles fonctionnalités de suivi de ga.js. <p class="line874">Pour utiliser Urchin avec un site Web dont le suivi est déjà effectué avec Google Analytics, il vous suffit de modifier légèrement le code de suivi Google Analytics. Voici la procédure à suivre : <ul><li><p class="line862">Copiez uniquement le fichier <tt class="backtick">__</tt>utm.gif, à partir du répertoire util/utm de la distribution Urchin, vers la racine de votre site Web (par exemple dans le répertoire principal de votre contenu). </li><li><p class="line862">Ajoutez la ligne <tt>_userv=2;</tt> (comme indiqué ci-dessous) au code de suivi des pages de votre site Web. Assurez-vous de ne modifier aucune autre partie du code de suivi existant. </li></ul><p class="line867"><pre>&lt;script src="http://www.google-analytics.com/urchin.js"
type="text/JavaScript"&gt;
&lt;script type="text/JavaScript"&gt;
  _userv=2;
  _uacct="UA-XXXXXXX-Y";
  urchinTracker();
&lt;/script&gt;
</pre><ul><li>Lorsque vous ajoutez des profils dans Urchin, assurez-vous de spécifier Urchin Traffic Monitor (UTM) comme méthode de suivi des visiteurs. </li></ul></div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>