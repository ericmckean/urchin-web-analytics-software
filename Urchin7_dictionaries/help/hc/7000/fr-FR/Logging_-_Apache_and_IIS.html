<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>Journalisation - Apache et IIS</strong> <p class="line867"><strong>Présentation</strong> <p class="line874">Il est essentiel que la journalisation de votre serveur Web utilise un format permettant à Urchin d'interpréter correctement les données et de produire des rapports aussi précis que possible. Cet article décrit la procédure à suivre avec les serveurs Web les plus répandus, Apache et Microsoft IIS. Pour une précision optimale, votre journalisation doit inclure le Site référent et le User-Agent. Vous devez en outre activer la journalisation des cookies afin de pouvoir comptabiliser les visiteurs uniques à l'aide de l'UTM (Urchin Tracking Module). Le suivi UTM reste le seul moyen de comptabiliser les véritables visiteurs uniques. Il est conseillé, mais pas obligatoire, d'arrêter votre choix d'utiliser ou non l'UTM avant de modifier la journalisation de votre serveur Web. Si vous optez pour l'UTM, vous pouvez activer les cookies dans vos journaux dès maintenant. L'activation des cookies n'a aucune incidence sur la suite, mais n'installez pas l'UTM sur votre site Web pour le moment. Consultez tout d'abord la section relative au Suivi des visiteurs afin de vous familiariser avec l'installation de l'UTM. <p class="line867"><strong>Configuration</strong> <p class="line867"><strong>Apache</strong> <p class="line874">Par défaut, Apache utilise ce que l'on appelle un format de journal courant et propose également un format plus détaillé, le format de fichier journal NCSA étendu/combiné. Pour exploiter au mieux la création de rapports, vous devez fournir à Urchin une variante du format NCSA étendu/combiné. Configurez votre serveur Apache comme suit, de manière à utiliser le format approprié : <p class="line874">1. Enregistrez une copie de sauvegarde de votre fichier httpd.conf. Ouvrez ensuite le fichier httpd.conf original dans un éditeur de texte. <p class="line862">2. Recherchez la section dont les lignes commencent par "LogFormat". <p class="line862">3. Ajoutez une ligne LogFormat en utilisant l'un des formulaires présentés ci-dessous, selon que vous utiliserez ou non l'UTM. Cette entrée LogFormat doit être ajoutée à votre fichier de configuration sur une seule ligne, sans retour chariot ni saut de ligne. Veillez à saisir correctement tous les caractères. <p class="line867"><strong>Pour les sites Web qui n'utilisent pas l'UTM :</strong> <p class="line867"><tt>LogFormat&nbsp;"%h&nbsp;%v&nbsp;%u&nbsp;%t&nbsp;\"%r\"&nbsp;%&gt;s&nbsp;%b&nbsp;\"%{Referer}i\"&nbsp;\"%{User-Agent}i\""&nbsp;urchin</tt> <p class="line867"><strong>Pour les sites Web qui utilisent l'UTM :</strong> <p class="line867"><tt>LogFormat&nbsp;"%h&nbsp;%v&nbsp;%u&nbsp;%t&nbsp;\"%r\"&nbsp;%&gt;s&nbsp;%b&nbsp;\"%{Referer}i\"&nbsp;\"%{User-Agent}i\"&nbsp;\"%{Cookie}i\""&nbsp;urchin</tt> <p class="line862">4. Le terme "urchin" inclus à la fin de la ligne LogFormat est un pseudonyme qui permettra d'appliquer ce format à des fichiers journaux dans d'autres sections de votre fichier httpd.conf. Vous pouvez remplacer cette chaine par le mot de votre choix, mais "urchin" vous rappellera que cette entrée a été saisie spécialement pour les traitements Urchin. <p class="line862">5. Examinez l'entrée &lt;VirtualHost&gt; pour laquelle vous souhaitez activer ce nouveau format de journalisation. Désactivez toutes les entrées TransferLog et CustomLog présentes dans le groupe &lt;VirtualHost&gt;&lt;/VirtualHost&gt; en insérant un dièse (#) devant chacune d'elles (TransferLog devient #TransferLog). Ajoutez ensuite l'entrée CustomLog suivante, en remplaçant la chaîne path_to_log par le chemin d'accès à votre journal : <p class="line867"><tt>CustomLog&nbsp;path_to_log/access.log&nbsp;urchin</tt> <p class="line862">Si vous avez utilisé un pseudonyme autre que "urchin" dans l'entrée LogFormat saisie précédemment, utilisez ce même pseudonyme dans l'entrée CustomLog à la place de "urchin". <p class="line874">6. Enregistrez les modifications apportées à votre fichier httpd.conf. <p class="line862">7. <strong>IMPORTANT !</strong> Vérifiez la syntaxe de votre nouveau fichier httpd.conf en exécutant la commande : <p class="line867"><tt>apachectl&nbsp;configtest</tt> <p class="line874">Vous devriez obtenir une réponse du type : syntaxe ok. Dans le cas contraire, contrôlez votre fichier httpd.conf afin de corriger les erreurs. Ne poursuivez pas cette procédure sans avoir obtenu une réponse positive. Enregistrez une copie de sauvegarde de votre fichier modifié, puis restaurez l'original en remplaçant cette version du fichier httpd.conf par la copie que vous aviez enregistrée au début de la procédure. Ainsi, votre serveur Web continuera de fonctionner normalement, tandis que vous chercherez les erreurs commises lors de vos modifications. <p class="line874">8. Une fois la syntaxe de votre fichier httpd.conf validée, redémarrez Apache. La meilleure méthode consiste à appeler le script apachectl, généralement installé en même temps qu'Apache. <p class="line867"><tt>apachectl&nbsp;restart</tt> <p class="line862">9. Contrôlez la journalisation. Ouvrez un navigateur et accédez à plusieurs reprises au site concerné. Examinez ensuite les dernières lignes du fichier journal spécifié dans votre entrée CustomLog. Vous devriez constater que des appels de fichier récents ont été consignés dans le journal. <p class="line874">Le journal au format étendu/combiné modifié pour Urchin produit des lignes similaires à la suivante : <p class="line867"><tt class="backtick">64.40.51.27</tt> <tt class="backtick">www.urchin.com</tt> <tt class="backtick">-</tt> <tt class="backtick">[28/Aug/2002:15:11:01</tt> <tt class="backtick">-0700]</tt> <tt class="backtick">"GET</tt> <tt class="backtick">/images/urchin_header_logo.gif</tt> <tt class="backtick">HTTP/1.1"</tt> <tt class="backtick">200</tt> <tt class="backtick">3017</tt> <tt class="backtick">"http://www.urchin.com/"</tt> <tt class="backtick">"Mozilla/4.0</tt> <tt class="backtick">(compatible;</tt> <tt class="backtick">MSIE</tt> <tt class="backtick">6.0;</tt> <tt class="backtick">Windows</tt> <tt class="backtick">NT</tt> <tt class="backtick">5.0)"</tt> <p class="line874">Si vous avez configuré l'UTM sur votre site et activé la journalisation des cookies, les lignes de votre journal se présentent comme suit : <p class="line867"><tt class="backtick">64.40.51.27</tt> <tt class="backtick">www.urchin.com</tt> <tt class="backtick">-</tt> <tt class="backtick">[28/Aug/2002:15:11:01</tt> <tt class="backtick">-0700]</tt> <tt class="backtick">"GET</tt> <tt class="backtick">/images/urchin_header_logo.gif</tt> <tt class="backtick">HTTP/1.1"</tt> <tt class="backtick">200</tt> <tt class="backtick">3017</tt> <tt class="backtick">"http://www.urchin.com/"</tt> <tt class="backtick">"Mozilla/4.0</tt> <tt class="backtick">compatible;</tt> <tt class="backtick">MSIE</tt> <tt class="backtick">6.0;</tt> <tt class="backtick">Windows</tt> <tt class="backtick">NT</tt> <tt class="backtick">5.0)"</tt> <tt class="backtick">"__utma=171060324.1378004559.1063331913.1063334677.1063521838.3;</tt> <tt class="backtick">__utmb=171060324;</tt> <tt class="backtick">__utmc=171060324"</tt> <p class="line874">10. Notez l'information supplémentaire relative au cookie UTM en fin de ligne. <p class="line867"><strong>Serveur IIS Microsoft (Internet Information Server)</strong> <p class="line874">Remarque : Microsoft IIS fait appel au format de journalisation W3C. <p class="line874">Vos fichiers journaux IIS doivent comprendre au moins les champs répertoriés ci-dessous pour permettre à Urchin de générer les rapports les plus élémentaires : <ul><li>Date </li><li>Time </li><li>C-IP </li><li>CS-URI-Stem </li><li>SC-Status </li><li>SC-Bytes </li></ul><p class="line874">Ces champs sont obligatoires. Sans eux, les rapports que vous obtiendrez ne seront pas significatifs. Toutefois, un journal aussi épuré ne fournit pas suffisamment d'informations pour établir des rapports sur les sites référents et les navigateurs. C'est pourquoi il est conseillé de définir des propriétés de journalisation plus précises pour votre serveur IIS. <p class="line874">Vous pouvez définir les propriétés de journalisation de votre serveur IIS de façon globale ou spécifique à chaque domaine géré par le serveur. Pour les serveurs regroupant de nombreux domaines, nous recommandons de procéder de manière globale. La procédure ci-après garantit l'enregistrement des champs obligatoires dans votre fichier journal. Si vous choisissez de journaliser d'autres champs, Urchin les ignorera lors du traitement. Sachez toutefois que l'enregistrement de champs superflus augmente la taille de vos fichiers journaux. Il est donc préférable de journaliser uniquement les champs nécessaires à Urchin. <p class="line862">1. Lancez l'outil de gestion des services IIS à l'aide du menu Démarrer-&gt;Programmes-&gt;Outils d'administration-&gt;Gestion de l'ordinateur. <p class="line874">2. Développez l'arborescence des Services et applications, puis sélectionnez Services Internet (IIS) pour afficher la liste des sites Web (sous Windows Server 2003 vous devez également développer le dossier Sites Web pour obtenir la liste des sites). <p class="line874">3. Cliquez avec le bouton droit sur l'entrée correspondant au site à modifier, puis sélectionnez Propriétés. <p class="line874">4. Ouvrez l'onglet Site Web et vérifiez dans la partie inférieure de l'écran que la case Activer la journalisation est cochée. Puis, dans le menu déroulant Format du journal actif, choisissez Format de fichier journal étendu W3C. <p class="line874">5. Cliquez sur le bouton Propriétés en regard du champ Format du journal actif. <p class="line874">6. Sélectionnez l'onglet Propriétés étendues. <p class="line874">7. Cochez les cases associées aux champs suivants : <ul><li>Date [ date] </li><li>Heure [ time ] </li><li>Adresse IP du client [ c-ip ] </li><li>Nom d'utilisateur [ cs-username ] </li><li>Méthode [ cs-method ] </li><li>Ressource URI [ cs-uri-stem ] </li><li>Requête URI [ cs-uri-query ] </li><li>État protocole [ sc-status ] </li><li>Octets envoyés [ sc-bytes ] </li><li>Agent utilisateur [ cs[User-Agent] ] </li><li>Référant [ cs[Referer] ] </li><li>Cookie [ cs[Cookie] ] (champ obligatoire uniquement pour le suivi UTM) </li></ul><p class="line874">8. Assurez-vous que la case Comptabilisation des processus n'est pas cochée, car cette option ne fournit aucune information utile sur les accès Web. <p class="line874">9. Sélectionnez Appliquer et OK dans chacune des fenêtres pour enregistrer vos paramètres. <p class="line874">10. Le redémarrage du serveur IIS n'est pas nécessaire. Les entrées de vos journaux sont immédiatement enregistrées selon vos nouveaux paramètres. </div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>