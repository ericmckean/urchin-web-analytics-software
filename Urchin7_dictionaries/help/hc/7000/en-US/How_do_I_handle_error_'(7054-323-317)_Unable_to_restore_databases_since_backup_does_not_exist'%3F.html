<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>How do I handle error '(7054-323-317) Unable to restore databases since backup does not exist'?</strong> <p class="line867"><strong>Description of Problem</strong> <p class="line874">When running an Urchin profile, you get the following messages: <p class="line874">(7050-323-317) Starting automatic rollback + <p class="line874">(7054-323 317) Unable to restore databases since backup does not exist. <p class="line867"><strong>Cause</strong> <p class="line874">This error may result if a previous run of this Urchin Profile was terminated abnormally. This could happen if the process/task of the 'log processing engine' was manually terminated by the system administrator (from the console CLI, etc.), or another unexpected problem occured which terminated an ongoing log processing, or perhaps due to a system reboot, and this process was not completed properly. <p class="line874">Ordinarily, Urchin is able to recover gracefully from an abnormal termination by rolling back to the last known good state of the Profile; however, if the profile processing was terminated on the first run of a profile (or the first run for a month), there will be no backup file to roll back to. At this point, Urchin issues the "Unable to restore databases" error. <p class="line874">On a more technical level, the Urchin log processing engine creates a lock.udb file in the reporting directory for the profile it is currently processing. It keeps this file locked while processing to ensure that only one instance of the log processing engine can run for the profile at any given time. At startup time, the log processing engine checks for the existence of the lock.udb file. If the file is present, the log processing engine checks for current locks. If none are found, then the previous run of the profile failed, so the log processing engine attempts to rollback the profile's databases to the last known good state before proceeding. As noted above, if the rollback archive does not exist, the rollback error messages are printed and the log processing terminates. <p class="line867"><strong>Remedy</strong> <p class="line874">Due to the fact that the previous run of Urchin terminated abnormally, the Urchin databases for the month being processed are in an unknown state and the data contained in them was not properly checkpointed. Therefore, the data for the entire month being processed will need to be removed. In most cases, the only Urchin data for the month will be that created during the failed processing run, so no good data exists anyway. <p class="line874">Please use the following procedure to reset the Urchin profile data and allow you to continue running the profile: <p class="line867"><span class="u">Windows Systems</span> <ol type="1"><li><p class="line862">Start a DOS Shell (Start -&gt; Run -&gt; "cmd") </li><li>Change directory to the folder where Urchin profile data is stored, usually <ul><li style="list-style-type:none">C:\Program Files\Urchin\data\reports\profilename </li></ul></li><li>View the contents of the lock.udb file with the command "TYPE lock.udb". There should be one or more lines consisting of YYYYMM date entries, e.g. 200408. </li><li>For each YYYYMM line the in lock.udb file, perform the following steps: <ul><li>Remove the corresponding monthly Urchin databases with the command "DEL YYYYMM-*data*" </li><li>Check to see if a backup archive exists for the corresponding month using the command "DIR YYYYMM*backup*.zip". The backup archives are named YYYYMM-backup-YYYYMMDDHHMMSS.zip, e.g. 200805-backup-20080331103340.zip. </li><li>If one or more backup file exists for that month, restore the data from the backup archive with latest timestamp using the command "..\..\..\util\unzip -o -u backupfile.zip", e.g. "..\..\..\util\unzip -o -u 200805-backup-20080331103340.zip" </li></ul></li><li>Remove the lock.udb file with the command "DEL lock.udb" </li><li>You can now run the profile again with the Run Now button </li></ol><p class="line867"><span class="u">UNIX-type Systems</span> <ol type="1"><li>Start a command shell either as "root" or the user that Urchin runs as </li><li>Change directory to the location where the Urchin profile data is kept - e.g. <ul><li style="list-style-type:none">"cd /usr/local/urchin/data/reports/profilename" </li></ul></li><li>View the contents of the lock.udb file with the command "cat lock.udb". There should be one or more lines consisting of YYYYMM date entries, e.g. 200803. </li><li>For each YYYYMM line the in lock.udb, perform the following steps: <ul><li>Remove the corresponding monthly Urchin databases with the command "rm YYYYMM-*data*" </li><li>Check to see if a backup archive exists for the corresponding month using the command <ul><li style="list-style-type:none">"ls YYYYMM*backup*.zip". The backup archives are named YYYYMM-backup-YYYYMMDDHHMMSS.zip, e.g. 200803-backup-20080331103340.zip. </li></ul></li><li>If one or more backup file exists for that month, restore the data from the backup archive with latest timestamp using the command "../../../util/unzip -o -u backupfile.zip", e.g. "../../../util/unzip -o -u 200803-backup-20080331103340.zip" </li></ul></li><li>Remove the lock.udb file with the command "rm lock.udb" </li><li>You can now run the profile again with the Run Now button </li></ol></div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>