<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>ログ ファイル パスでのワイルドカードと日付の置換</strong> <p class="line867"><strong>概要</strong> <p class="line874">Urchin ではログ ファイルへのパスにワイルドカードや日付一致変数を指定できます。 Urchin のタスクが実行されログ ファイル パスが読み込まれる際に変数が変換され、システム上のディレクトリやファイル名と照合されます。 <p class="line874">Urchin 6 の日付一致機能は、Urchin の以前のバージョンで提供されていた機能から次の点が拡張されています。 <ul><li>日付置換はログ ファイル パス名のどの部分も対象にできます。Urchin の以前のバージョンでは、実際のファイル名の仕様のみが対象でした。 </li><li>データ パターンの照合アルゴリズムの性能と柔軟性が強化された一方で、以前の YYYYMMDD 形式のパターン一致も下位互換性を保つため引き続きサポートされています。 </li></ul><p class="line874">最もよく使用される時間の一致変数と形式を次に示します。 サポートされているすべての時間形式変数はこの記事の最後に記載されています。 <p class="line874">* アスタリスクは 0 文字以上の文字列を表します。 DD は月単位の日付を示す 2 桁の数値 (01～31 など) で置換されます。 %d は DD と同じです。 MM は月を示す 2 桁の数値 (01～12 など) で置換されます。 %m は MM と同じです。 YY は年を示す 2 桁の数値 (01～99 など) で置換されます。 YYYY は年を示す 4 桁の数値 (0001～2003 など) で置換されます。 %Y は YYYY と同じです。 <p class="line874">この形式でのアスタリスクは、UNIX や DOS のコマンド シェルにおけるファイル名マッチングと同じように機能し、正規表現一致のように直前の文字を 0 回以上繰り返すことにはなりません。 これらの変数は自由に組み合わせて使用できます。 <p class="line874">2003年8月13日にこれらの変数が変換された場合の例を下記に示します。 日付の指定子である DD と %d が 13 日の前日に変換される点にご注意ください。 <ul><li>YYYYMMDD は 20030812 に変換されます。 </li><li>%Y-%m-%d は 2003-08-12 に変換されます。 </li><li>%Y/%m/%d は 2003/08/12 に変換されます (パスで使用すると影響が生じます)。 </li><li>*YYYYMMDD は、20030812 という文字列で終わるファイル名に一致します。  </li></ul><p class="line874">DD と %d の日付指定子は、デフォルトで前日に変換されます。これは、ウェブサーバー ログと Urchin 処理の一般的な管理方法に合わせるためです。 通常、ログはサイズが大きくなりすぎないよう毎日ローテーションで上書きされるため、個々のログには 1 日分のデータが含まれます。 ローテーションは午前 0 時の直前に行われることが多く、その後 Urchin は午前 0 時を過ぎて翌日になった時点で処理を開始します。 ログ ファイルがローテーションされた時点で YYYYMMDD 形式のタイムスタンプをログ ファイル名に追加すると、ログ ファイルの日付と Urchin の実行時間に 1 日の違いが生じます。 Urchin の実行時に日付が変換されると、ログのタイムスタンプは 20030812 で読み込まれますが Urchin は 20030813 に実行されるため、正しいログ名を見つけることができません。 <p class="line874">以上はログ管理の最も一般的な方法ですが、これ以外の方法もあるため、 Urchin にはこれらの変数を日付に変換する方式を制御する設定パラメータがあります。 ログ ファイル パス名の設定で日付と時間のワイルドカード置換を使用すると、タイム オフセットを調整して DD と %d の変換方法を制御できます。 この設定については、この記事の最後で詳しく説明します。 <p class="line874">年、月、日の変数は、ログ ファイル名やログ ファイルのディレクトリ/フォルダ パスのどちらにも使用できますが、 アスタリスクはログ ファイル パスのファイル名の部分にのみ使用できます。 また、時間形式の変数はログ ソース パス内で繰り返し使用できますが、アスタリスクを使用できるのは 1 回のみです。 これについては、手順セクションの例で詳しく説明します。 <p class="line867"><strong>手順</strong> <p class="line874">ログ ソースを作成、編集する際は、[ログ設定] タブの [ログ ファイル パス] ボックスで使用したパスの時間変数を使用する必要があります。 Apache ウェブサーバーで毎日行われる一般的なログ ローテーション スキームでは、ログ エントリの日付を示す日付スタンプでログが作成されます。たとえば、2002年7月16日午前0時1分過ぎの時点で、次のログがログ ローテーション メカニズムでアーカイブされ、 <pre>/var/log/httpd/access.log
</pre><p class="line874">次のファイルで保存されるとします。 <pre>/var/log/httpd/access.log.20020715
</pre><p class="line874">Urchin プロファイルでログ ソースのこのパターンを照合するには、ログ ファイル パスで次のように指定すると、 <pre>/var/log/httpd/access.log.YYYYMMDD
</pre><p class="line874">Urchin の実行時に自動的に前日のログが検出されます。 別の例として、Microsoft の IIS ウェブサーバーでログを毎日ローテーションするよう設定している場合、ex021127.log のようにログ ファイル名の一部として当日の日付が追加されます。 このため、毎日の IIS ログを処理するには、プロファイルのログ ソースのログ ファイル パス フィールドで <pre>C:\WINNT\System32\LogFiles\W3SVC1\exYYMMDD.log
</pre><p class="line874">のようにログ ファイルを指定します。 <p class="line874">毎日 2 回以上ローテーションされるログを Urchin で処理するには、前日に作成されたすべてのログ ファイルに一致するよう、YYYYMMDD のシンタックスとワイルドカードを組み合わせて使用できます。 この場合、ファイル名に時間を追加するなど、ローテーションするログ ファイル名の一貫性を保つ必要があります。 その上で、ログ ファイル パスとして次のようなパターンや、 <pre>/var/log/httpd/access.log.YYYYMMDD*
</pre><p class="line874">次のようなパータンを指定します。 <pre>C:\WINNT\System32\LogFiles\W3SVC1\exYYMMDD*.log
</pre><p class="line874">さらに複雑なケースとして、年、月、日を反映した名前のディレクトリにログが保存されている場合があります。 次のディレクトリ パスにログを保存しているとします。 <pre>/logs/2003/07
/logs/2003/08
/logs/2003/09
</pre><p class="line874">このとき、特定の月のすべてのログを対応するディレクトリに保存し、各ログ ファイル名に月単位の日付を追加しているとします (access.log.01、access.log.02 など)。 Urchin で処理するログを検出できるようにするには、次のいずれかのログ ファイル パス形式を使用します。 <pre>/logs/YYYY/MM/access.log.DD
/logs/%Y/%M/access.log.%d
</pre><p class="line874">これにより、Urchin でログを処理する際に、末尾が前日の日付のパターンに一致するすべてのログを処理できます。 ログ ファイル パス フィールドの指定でワイルドカードを使用する場合は、プロファイルのログ トラッキングを有効にして Urchin でログを再処理しないようにすることが重要です。 <p class="line867"><strong>アドバイス</strong> <p class="line874">Urchin では、置換パターンの日付を割り出す際に現地時間の現在時刻から 24 時間を差し引き、 必要に応じて月や年の境界を適切に処理します。 ただし、ログ ソースの [詳細設定] タブにあるログ ファイル パス名の設定で日付/時間のワイルドカード置換を使用して、この処理を変更できます。 時間調整の基準として現地時間かグリニッジ標準時間 (GMT) のいずれかを選択してから、時間編集ボックスを使用して時間のオフセットを調整できます。 <p class="line867"><strong>日付/時間形式の全リスト</strong> <p class="line874">サポートされている時間形式変数の全リストで、標準 C ライブラリの strftime() ルーチンで使用される形式に準じています。 <ul><li>%A = 曜日の完全名 </li><li>%a = 曜日の短縮名 </li><li>%B = 月の完全名 </li><li>%b = 月の短縮名 </li><li>%d = 月単位の日付の 10 進数表記 (01～31) </li><li>%e = 月単位の日付の 10 進数表記 (1～31)、1～9 は 1 桁で表記 </li><li>%H = 24 時間表示の時間の 10 進数表記 (00～23) </li><li>%I = 12 時間表示の時間の 10 進数表記 (01～12) </li><li>%j = 年単位の日付の 10 進数表記 (001～366) </li><li>%k = 24 時間表示の時間の 10 進数表記 (0～23)、0～9 は 1 桁で表記 </li><li>%l = 12 時間表示の時間の 10 進数表記 (1～12)、1～9 は 1 桁で表記 </li><li>%M = 分の 10 進数表記 (00～59) </li><li>%m = 月の 10 進数表記 (01～12) </li><li>%p = 午前または午後を示す表記 </li><li>%S = 秒の 10 進数表記 (00～60) </li><li>%s = 1970年1月1日0時0分0秒からの経過秒数 (mktime(3) を参照) </li><li>%w = 週単位の日 (日曜日から開始) の 10 進数表記 (0～6) </li><li>%Y = 世紀を使用した年の 10 進数表記 </li><li>%y = 世紀を使用しない年の 10 進数表記 (00～99) </li><li>%z = UTC (協定世界時) を基準としたタイムゾーンのオフセット値。UTC の東側はプラス記号、西側はマイナス記号が先頭に付き、時間と分はそれぞれ 2 桁で表示され、間に区切り文字はなし (RFC 822 dの日付ヘッダーで一般的な形式) </li><li>%% = `%'. (日付/時間エントリの内部で文字としてパーセント記号が必要な場合に使用)  </li></ul></div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>