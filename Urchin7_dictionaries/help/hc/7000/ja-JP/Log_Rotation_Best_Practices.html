<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>ログ ローテーションのベスト プラクティス</strong> <p class="line867"><strong>概要</strong> <p class="line874">一般的にウェブサーバーなどのシステム サービスやアプリケーションの動作環境では、サービスに関連した処理やイベントを記録するログ ファイルを生成します。 また、ログ ファイルのサイズを抑制するため、オペレーティング システムやアプリケーションでログ ファイルを定期的に管理する手法も一般的です。 これにより、ログ ファイルが際限なく増大して、ディスク容量を使い果たしてしまうのを防ぐことができます。 <p class="line874">ログ管理の一般的な手法では、既存のログの名前にタイムスタンプを追加して変更し、サイズがゼロの新しいログ ファイルでサービスやアプリケーションを再開するログ ローテーション タスクを定期的にスケジュールします。 ログ ローテーション タスクで古いログ ファイルを圧縮し、一定期間が経過したりローテーション サイクルの期限に達したログ ファイルを削除する手法も一般的です。 <p class="line874">ウェブサーバー ログの場合、ログを適切なサイズに維持するため、通常はローテーションを毎日実施します。 また、Urchin などの分析ツールを使用してウェブサーバー ログの後処理を行う上でも、ローテーションを毎日実施するのが適切です。 Microsoft の IIS などの一部のウェブサーバーにはログ ローテーション機能が内蔵されており、この機能を有効にすると、デフォルトでログが毎日ローテーションされます。 Apache などの他のウェブサーバーにはログ ローテーション専用のハンドラはありませんが、ログ ローテーションの処理に対応するため、ウェブ サービスを中断することなくウェブサーバーを簡単に再起動できるツール (例: apachectl restart) があります。 <p class="line867"><strong>ログ ローテーションの手法</strong> <p class="line874">Urchin のログ トラッキング技術により、ログ ローテーションでログの重複処理を回避する必要性はなくなりました。 これにより、ウェブサーバーで書き込みを行っている「使用中」のログや、手動または不規則にローテーションされるログを処理できるなど、Urchin でログを処理する際の柔軟性が大幅に向上しました。 <p class="line867"><strong>重要: </strong> Urchin の以前のバージョンとは異なり、Urchin 6 ではログ ローテーション プロシージャを呼び出したり、ログ ローテーション タスクの完了後にウェブサーバーを再起動する機能はありません。ただし、下記のようなログの後処理が可能です。 <p class="line874">Urchin 6 の動作上はウェブサーバー ログをローテーションする必要はありませんが、処理を効率化し、ログ トラッキング ユーティリティで不要な処理を行わずにすむよう、一般的なログ ローテーション スキームを導入することをおすすめします。 ファイル サイズが大きくなるほど処理も遅くなるため、システムとアプリケーションのどちらにとっても、サイズの大きい 1 つのログよりサイズの小さい複数のログを処理する方がはるかに効率的です。 サイズの小さいファイルであれば、ディスク エラーや他のシステム エラーが発生した場合のバックアップや復旧も容易になります。 <p class="line874">ログ ローテーション メカニズムはあまり複雑にする必要はありません。ほとんどの場合、UNIX 系システムの cron で簡単なシェル スクリプトや Perl スクリプトを毎日実行するだけで十分です。 スクリプトでは、既存のウェブサーバー ログをローテーションしてタイムスタンプ (%Y%m%d または YYYYMMDD 形式を使用) を付加し、ウェブサーバーを再起動する処理だけが必要です。 必要に応じて、ディスク容量を抑制するため、古いログファイルを削除するロジックを付加します。  <p class="line867"><strong>ログ ローテーションを使用する場合の Urchin の設定</strong> <p class="line874">ログ ローテーション スキームを導入した後、Urchin でローテーションされたログを処理するよう簡単に設定できます。 ログ ファイル パスの指定で、ログ ソースの設定時にタイムスタンプが付加されたログ ファイル名のパターンに一致するワイルドカード (例: Apache ログの場合は「access-log.*」、IIS ログの場合は「ex*.log」) を使用するか、Urchin に内蔵されたタイムスタンプ パターン マッチ (例: Apache の場合は「access-log.%Y%m%d」、IIS の場合は「ex%y%m%d.log」) を使用するよう設定します。 Urchin でこのパターンを検出すると %Y%m%d のパターンを前日の日付に置き換え、一致するファイル名 (例: access-log.20020617) のログを処理します。 日付一致パターンの詳細については、[ログ ファイル パスでのワイルドカードと日付の置換]をご覧ください。 <p class="line874">ワイルドカードを指定すると、未処理のログを 1 つのディレクトリにまとめて、次回の Urchin の実行時に処理することができます。 これは、Urchin の実行時にリモート ウェブサーバーがダウンしていたり、ネットワークに接続できないなどの理由により、予定のログ ファイルがそろわない場合に特に有効です。 ただし、Urchin でディレクトリを開いて各ログ ファイルを検索し、処理済みかどうかを確認する必要があるため、ディレクトリに多数のログ ファイルが存在する場合は、かなりのオーバーヘッドが発生する可能性があります。 ログ ローテーション スキームの信頼性が高い場合は、YYYYMMDD パターンの一致スキームを使用した方が効率的です。 <p class="line874">Urchin 6 では、処理の完了したログを削除、アーカイブ、圧縮することもできます。 これには、ログ ソースの [詳細設定] の [ログの処置] で別のオプションを設定します。 [ログの処置] 設定の詳細については、[ログの管理]をご覧ください。 <p class="line867"><strong>重要: </strong> [ログの処置] オプションは、ローテーションされていない使用中のログには使用できません。 <p class="line867"><strong>UNIX 系システムでのログ ローテーションの設定</strong> <p class="line874">オペレーティング システムの機能やウエブサーバーの構成にはさまざまな種類があり、ログ ローテーションの処理はサイト固有のものとなる可能性が高いため、UNIX-type 系システムでウェブサーバーのログ ローテーションを設定する共通の手法はありません。  <p class="line867"><strong>Windows IIS ウェブサーバーでのログ ローテーションの設定</strong> <p class="line874">前述のとおり、IIS の管理機能を使用するとウェブサーバーのログを自動的にローテーションできますが、この機能はデフォルトで有効ではありません。 IIS ウェブサーバーで適切なログ ローテーションを設定する手順は次のとおりです。 ログ ローテーションは毎日、現地時間を基準に行うよう設定することをおすすめします。 デフォルトで、IIS は現地時間ではなくグリニッジ標準時間 (GMT) の午前 0 時にログをローテーションします。 <p class="line874">Windows 2000 の場合は、IIS ウェブサーバーでログ ローテーションが適切に設定されていることを確認する必要があります。 これには Windows 2000 のコンピュータ管理機能を使用します。 Windows NT、Windows XP、Windows 2003 サーバーでも同様の手順を使用できます。 [コンピュータ管理] を開いてログ ローテーションを設定するには、次の操作を行います。 <ul><li><p class="line862">[スタート] -&gt; [設定] -&gt; [コントロール パネル] の順にクリックします。 </li><li>[管理ツール] をダブルクリックします。 </li><li>[コンピュータの管理] をダブルクリックします。 </li><li>[インターネット インフォメーション サービス] をダブルクリックします。 </li><li>[既定の Web サイト] を右クリックして [プロパティ] を選択します </li><li>ポップアップ ウィンドウで [Web サイト] タブを選択します。 </li><li>ウィンドウの下部にある [プロパティ] タブをクリックします。 </li><li>[新しいログ スケジュール] セクションの [毎日] ラジオボタンをクリックします。 </li><li>[ファイル名およびロールオーバーに地域設定を使用する] チェックボックスをオンにします。 </li></ul><p class="line874">これで、IIS でウェブサーバー ログが毎日午前 0 時過ぎにローテーションされるようになります。 </div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>