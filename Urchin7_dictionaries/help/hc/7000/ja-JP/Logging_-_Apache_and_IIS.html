<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>ログ - Apache と IIS</strong> <p class="line867"><strong>概要</strong> <p class="line874">ウェブサーバーのログは、Urchin でデータを適切に解読して詳細なレポートを生成できる形式に設定することが重要です。 ここでは、最も一般的なウェブサーバーである Apache と Microsoft IIS のログ設定手順を説明します。 最大限に詳細なレポートを作成するには、参照情報とユーザー エージェント情報のログを有効にする必要があります。 Urchin トラッキング モジュール (UTM) の使用時にユニーク ユーザー レポートを有効にするには、Cookie ログも有効にする必要があります。 正確なユニーク ユーザー レポートは UTM ベースのトラッキングでしか作成できないため、 ウェブサーバーのログを変更する前に UTM の使用を検討することをおすすめします。 使用する場合は、今すぐログの Cookie を有効にします。 Cookie を有効にしても、直ちにウェブサイトに UTM をインストールする必要はありませんので、 次の手順に進む前にユーザー トラッキングのセクションに目を通し、UTM のインストール手順を把握しておくことをおすすめします。 <p class="line867"><strong>設定</strong> <p class="line867"><strong>Apache</strong> <p class="line874">Apache ではデフォルトで Common ログ形式という形式でログが記録され、オプションとして NCSA Extended/Combined ログ形式という詳細な形式でログを記録することもできます。Urchin で適切なレポートを生成するには NCSA Extended/Combined 形式のバリエーションが必要です。 Apache で適切な形式を使用するよう設定する方法は次のとおりです。 <p class="line874">1. httpd.conf ファイルのバックアップ コピーを作成してから、 テキスト エディタを使用して元の httpd.conf ファイルを開きます。 <p class="line862">2. LogFormat という単語で始まる行を含むセクションを探します。 <p class="line862">3. UTM を使用するかどうかに応じて、下記のいずれかの形式の新しい LogFormat 行を挿入します。 LogFormat エントリは、キャリッジ リターンや改行を含まない 1 行で設定ファイルに追加する必要があります。 すべての文字を正しく入力するよう細心の注意を払ってください。 <p class="line867"><strong>UTM を使用しないウェブサイトの場合:</strong> <p class="line867"><tt>LogFormat&nbsp;"%h&nbsp;%v&nbsp;%u&nbsp;%t&nbsp;\"%r\"&nbsp;%&gt;s&nbsp;%b&nbsp;\"%{Referer}i\"&nbsp;\"%{User-Agent}i\""&nbsp;urchin</tt> <p class="line867"><strong>UTM が有効なウェブサイトの場合:</strong> <p class="line867"><tt>LogFormat&nbsp;"%h&nbsp;%v&nbsp;%u&nbsp;%t&nbsp;\"%r\"&nbsp;%&gt;s&nbsp;%b&nbsp;\"%{Referer}i\"&nbsp;\"%{User-Agent}i\"&nbsp;\"%{Cookie}i\""&nbsp;urchin</tt> <p class="line862">4. LogFormat 行の「urchin」という単語はこの形式をログ ファイルに適用するためのニックネームで、httpd.conf ファイルの他の部分で使用されます。 この文字列は自由に選択できます。 「urchin」を使用すると、このエントリが Urchin の処理用に作成されたことを識別できます。 <p class="line862">5. この新しいログ形式を有効にする &lt;VirtualHost&gt; エントリを確認します。 &lt;VirtualHost&gt;&lt;/VirtualHost&gt; グループ内にある既存の TransferLog や CustomLog エントリの前に # を挿入して (例: TransferLog を #TransferLog にする) 無効にしてから、 次の新しい CustomLog エントリを挿入します。path_to_log の文字列はログがある場所への適切なパスで置き換えます。 <p class="line867"><tt>CustomLog&nbsp;path_to_log/access.log&nbsp;urchin</tt> <p class="line862">前述の LogFormat エントリのニックネームとして「urchin」以外の識別子を選択した場合は、CustomLog エントリの「urchin」の代わりに選択したニックネームを使用します。 <p class="line874">6. 編集した内容を httpd.conf ファイルに保存します。 <p class="line862">7. <strong>重要: </strong> 次のコマンドを実行して、新しい httpd.conf のシンタックスをチェックします。 <p class="line867"><tt>apachectl&nbsp;configtest</tt> <p class="line874">シンタックスは問題なしと診断されます。 そうでない場合は、httpd.conf ファイルを再確認してエラーを修正します。 コマンドで正しい結果が得られない場合は次の手順に進まず、 編集したファイルのバックアップ コピーを作成してから、この手順の最初に保存した httpd.conf のコピーで現在のバージョンを上書きして復元します。 これにより、変更内容のエラーを特定する間、ウェブサーバーを通常どおりに機能させることができます。 <p class="line874">8. httpd.conf のシンタックスが正しいことを確認してから、Apache を再起動します。 これには、通常 Apache にインストールされている apachectl スクリプトを呼び出す方法をおすすめします。 <p class="line867"><tt>apachectl&nbsp;restart</tt> <p class="line862">9. ログを確認します。 ブラウザを開いて該当のサイトに何回かアクセスしてから、 CustomLog エントリで指定したログ ファイルの最後の数行を確認します。 直前の数回のアクセスがログに記録されているはずです。 <p class="line874">Urchin で修正した Extended/Combined ログ形式の場合、ログの行は次のようになります。 <p class="line867"><tt class="backtick">64.40.51.27</tt> <tt class="backtick">www.urchin.com</tt> <tt class="backtick">-</tt> <tt class="backtick">[28/Aug/2002:15:11:01</tt> <tt class="backtick">-0700]</tt> <tt class="backtick">"GET</tt> <tt class="backtick">/images/urchin_header_logo.gif</tt> <tt class="backtick">HTTP/1.1"</tt> <tt class="backtick">200</tt> <tt class="backtick">3017</tt> <tt class="backtick">"http://www.urchin.com/"</tt> <tt class="backtick">"Mozilla/4.0</tt> <tt class="backtick">(compatible;</tt> <tt class="backtick">MSIE</tt> <tt class="backtick">6.0;</tt> <tt class="backtick">Windows</tt> <tt class="backtick">NT</tt> <tt class="backtick">5.0)"</tt> <p class="line874">サイトに UTM を設定して Cookie ログを有効にした場合、ログの行は次のようになります。 <p class="line867"><tt class="backtick">64.40.51.27</tt> <tt class="backtick">www.urchin.com</tt> <tt class="backtick">-</tt> <tt class="backtick">[28/Aug/2002:15:11:01</tt> <tt class="backtick">-0700]</tt> <tt class="backtick">"GET</tt> <tt class="backtick">/images/urchin_header_logo.gif</tt> <tt class="backtick">HTTP/1.1"</tt> <tt class="backtick">200</tt> <tt class="backtick">3017</tt> <tt class="backtick">"http://www.urchin.com/"</tt> <tt class="backtick">"Mozilla/4.0</tt> <tt class="backtick">compatible;</tt> <tt class="backtick">MSIE</tt> <tt class="backtick">6.0;</tt> <tt class="backtick">Windows</tt> <tt class="backtick">NT</tt> <tt class="backtick">5.0)"</tt> <tt class="backtick">"__utma=171060324.1378004559.1063331913.1063334677.1063521838.3;</tt> <tt class="backtick">__utmb=171060324;</tt> <tt class="backtick">__utmc=171060324"</tt> <p class="line874">10. 行の最後に UTM の Cookie 情報が追加されている点にご注意ください。 <p class="line867"><strong>Microsoft Internet Information Server (IIS)</strong> <p class="line874">注:  Microsoft IIS では W3C ログ形式を使用します。 <p class="line874">Urchin で最も基本的なレポートを作成するには、IIS のログ ファイルに少なくとも次のフィールドが含まれている必要があります。 <ul><li>日付 (Date) </li><li>時間 (Time) </li><li>クライアント IP アドレス (C-IP) </li><li>URI Stem (CS-URI-Stem) </li><li>プロトコルの状態 (SC-Status) </li><li>送信バイト数 (SC-Bytes) </li></ul><p class="line874">これらのフィールドは必須です。 これらのフィールドがないと、有益なレポートを作成できません。 ただし、この最小限のログでは参照やブラウザに関する十分な情報が提供されないため、 IIS サーバーでより詳細なログ プロパティを設定することをおすすめします。 <p class="line874">IIS のログ プロパティは、サーバー全体またはサーバーのドメインごとに設定できます。 ドメインの数の多いサーバーでは、全体で設定することをおすすめします。 ログ ファイルの必須フィールドが記録されていることを次の手順で確認します。 他のフィールドを追加した場合、そのフィールドは Urchin の処理では無視されます。 ただし、不必要なフィールドを記録するとログ ファイルのサイズが増大するため、Urchin で必要なフィールドのみを記録することをおすすめします。 <p class="line862">1. [スタート] -&gt; [プログラム] -&gt; [管理ツール] -&gt; [コンピュータ管理] の順にクリックして、IIS サービス管理ツールを起動します。 <p class="line874">2. [サービスとアプリケーション] ツリーを展開して [インターネット インフォメーション サービス] を選択すると、ウェブサイトのリストが表示されます (ただし、Windows 2003 Server ではさらに [Web サイト] フォルダを展開してサイトのリストを表示する必要があります)。 <p class="line874">3. 変更するサイトのエントリを右クリックして [プロパティ] を選択します。 <p class="line874">4. [Web サイト] タブを選択し、画面下部のセクションで [ログの記録を有効にする] チェックボックスがオンになっていることを確認してから、 [アクティブ ログ形式] プルダウン メニューで [W3C 拡張ログ ファイル形式] を選択します。 <p class="line874">5. [アクティブ ログ形式] ボックスの横にある [プロパティ] ボタンをクリックします。 <p class="line874">6. [拡張プロパティ] タブをクリックします。 <p class="line874">7. 次のフィールドのチェックボックスをオンにします。 <ul><li>日付 [ date ] </li><li>時間 [ time ] </li><li>クライアント IP アドレス [ c-ip ] </li><li>ユーザー名 [ cs-username ] </li><li>メソッド [ cs-method ] </li><li>URI Stem [ cs-uri-stem ] </li><li>URI クエリ [ cs-uri-query ] </li><li>プロトコルの状態 [ sc-status ] </li><li>送信バイト数 [ sc-bytes ] </li><li>ユーザー エージェント [ cs[User-Agent] ] </li><li>履歴 [ cs[Referer] ] </li><li>Cookie [ cs[Cookie] ] (UTM トラッキングにのみ必要) </li></ul><p class="line874">8. [プロセス アカウンティング] のチェックボックスがオフであることを確認します (この機能ではウェブ アクセスに関する有益な情報は収集されないため)。 <p class="line874">9. 各ウィンドウで [適用] と [OK] をクリックして設定を保存します。 <p class="line874">10. IIS を再起動する必要はなく、 直ちに新しい設定に基づいたログ収集が開始されます。 </div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>