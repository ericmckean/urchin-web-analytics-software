<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>Urchin 6 インストール ガイド（FreeBSD、Linux）</strong> <ul><li style="list-style-type:none"><p class="line891"><em>この記事は Urchin ソフトウェア認定コンサルタントの</em> <a href="EpikOne.html">EpikOne</a><em> によって作成されています。</em> </li></ul><p class="line867"><strong>はじめに: 注（Urchin 6.500 を使用している場合）</strong> <p class="line862">Urchin 6.501 では CPC スケジューラに関する問題がいくつか修正されました。Urchin 6.500 から Urchin 6.601 にアップグレードする場合、処理済みの CPC データが誤っていたり不完全な場合、Urchin レポートが正しく作成されない場合がございます。Google AdWords から正しいデータを取得するには、（a） Urchin 6.601 を新しい場所にインストールする、（b）既存の 6.500 に上書きインストールする場合は、古い CPC データを削除することをおすすめします。（b）の場合は下記のディレクトリのコンテンツをすべて削除してください。 <p class="line867"><pre>&lt;path_to_urchin_6500_installation&gt;/data/cpc/...
&lt;path_to_urchin_6500_installation&gt;/data/history/cpc/...
</pre><p class="line874">Urchin 6.600、6.501、Urchin 6.402 以前からアップグレードする場合、特別な手続きは必要ございません。 <p class="line867"><strong>はじめに - 注（FreeBSD を使用している場合）</strong> <ul><li>FreeBSD では、プロセスのデータサイズを 500 MB に制限するようハードコードされていますが、ログ処理中にメモリを使用する Urchin の地域データによってこの制限を超過してしまうため、Urchin を実行できません。下記のようなランタイム エラーが表示されます。 </li></ul><p class="line867"><pre>ERROR: (8011-323-1057) Failed to allocate memory
</pre><ul><li style="list-style-type:none">この問題を解決するには、FreeBSD システムのデフォルトのプロセス データサイズを増やす必要がございます。これには、/boot/loader.conf ファイルを編集し、下記の行を追加します。 </li></ul><p class="line867"><pre># Increase max process data segment size to 1GB
kern.maxdsiz="1073741824"
</pre><ul><li style="list-style-type:none">その後、再起動を行います。 </li><li>FreeBSD には accf_http と呼ばれる特殊なドライバがあり、処理速度とパフォーマンスを高めるため、完全な HTTP リクエストが届くまで外部からの接続をバッファします。デフォルトではこのドライバはカーネルに読み込まれず、下記の警告が表示されます。 </li></ul><p class="line867"><pre>[warn] (2)No such file or directory: Failed to enable the ‘httpready’ Accept Filter
</pre><ul><li style="list-style-type:none">この問題を解決するには、HTTP Accept Filter FreeBSD カーネル モジュール（accf_http）を有効にする必要がございます。これには、/boot/loader.conf ファイルを編集し、下記の行を追加します。 </li></ul><p class="line867"><pre># Wait for full HTTP request accept filter
accf_http_load="YES"
</pre><ul><li style="list-style-type:none">その後、再起動を行います。 </li></ul><p class="line867"><strong>警告</strong>このような方法でシステムの制限値を変更する場合は、慎重に作業を行ってください。kern.maxdsiz の設定値が大きすぎると、システムを起動できなくなる場合がございます。変更の前に FreeBSD のマニュアルを確認し、独自のサイト構成に適用した場合に予測されるリスクを検証することを<strong>おすすめ</strong>します。 <p class="line867"><strong>インストール手順の概要</strong> <ul><li>Urchin システムに使用するデータベース サーバーをインストールするか、既存のサーバーに Urchin のデータベースを追加します。現在サポートされているデータベース エンジンは下記のとおりです。 <ul><li>MySQL 5.0.3 以降（注: Urchin 6.6 以降では MySQL 4.x.x はサポートされません） </li><li>PostgreSQL 8.2.5 以降 </li></ul></li></ul><p class="line874">* データベース サーバーで Urchin データベースとユーザーを作成し、アクセス権限を設定します。 <ul><li>Urchin ソフトウェアを一時ディレクトリに展開します。 </li><li>install.sh スクリプトを実行します。 </li><li>Urchin インストール ライセンスを取得します。 </li></ul><p class="line867"><strong>オプション 1: MySQL で Urchin を使用する</strong> <ul><li><p class="line862">システムに MySQL サーバーをまだ設定していない場合は、<a class="http" href="http://dev.mysql.com/downloads/">http://dev.mysql.com/downloads/</a> から入手できます。 </li><li>MySQL サイトの手順で MySQL サーバーをインストールします。 </li><li>MySQL データベースの管理者ログイン情報（root など）とパスワードを確認しておきます。 </li><li>Urchin で使用するデータベース名と、ローカルの MySQL のユーザーおよびパスワードを指定します。この情報は後で Urchin をインストールする場合に必要となるため保存しておきます。下記の例では、urchin という名前のデータベースを作成し、MySQL のユーザー名を urchin、パスワードを urchinpassword に指定しています（パスワードは独自のものを指定してください）。 </li><li>下記のコマンドを使用して、Urchin データベースを作成し、ユーザーと権限の設定を行います。 </li></ul><p class="line867"><pre>root@yourserver# mysql -u root -p
mysql&gt; create database urchin character set utf8;
mysql&gt; GRANT ALL ON urchin.* to 'urchin'@'localhost' IDENTIFIED BY 'urchinpassword';
</pre><ul><li>MySQL サーバーと通信するための MySQL ソケットのパス名を確認します。通常は MySQL の my.cnf ファイルに「socket=/var/lib/mysql/mysql.sock」のように記述されています。 </li></ul><p class="line867"><strong>オプション 2: PostgreSQL で Urchin を使用する</strong> <ul><li><p class="line862">システムに PostgreSQL サーバーをまだ設定していない場合は、<a class="http" href="http://www.postgresql.org">http://www.postgresql.org</a> から入手できます。 </li><li>PostgreSQL サイトの手順で PostgreSQL サーバーをインストールします。 </li></ul><p class="line874">* psql コマンドがパス内にあることと、PostgreSQL データベースの管理者ログイン情報（pgsql など）とパスワードを確認しておきます。 * Urchin で使用するデータベース名、ローカルの PostgreSQL のユーザーとパスワードを指定します。この情報は後で Urchin をインストールする場合に必要となるため保存しておきます。下記の例では、urchin という名前のデータベースを作成し、PostgreSQL のユーザー名を urchin、パスワードを urchinpass に指定しています（パスワードは独自のものを指定してください）。 <ul><li>下記のコマンドを使用して、Urchin データベースを作成し、ユーザーと権限の設定を行います。 </li></ul><p class="line867"><pre>root@yourserver# psql -U pgsql -d postgres
postgres=# CREATE DATABASE urchin WITH ENCODING 'UTF8';
postgres=# CREATE USER urchin WITH PASSWORD 'urchinpass';
postgres=# GRANT ALL ON DATABASE urchin TO urchin;
postgres=# \connect urchin;
postgres=# CREATE LANGUAGE 'PLPGSQL';
</pre><p class="line867"><strong>Urchin のインストール</strong> <ul><li>上記で指定した Urchin データベース名、ユーザー、パスワードを確認しておきます。 </li><li>一時ディレクトリを作成し、Urchin ソフトウェアを展開します。 </li></ul><p class="line867"><pre>mkdir /var/tmp/urchintemp
cd /var/tmp/urchintemp
tar xzvf urchin6601_&lt;platform&gt;_installer.tar.gz
</pre><p class="line867"><strong>重要</strong> インストールを正しく行うには、インストールするコンピュータで Urchin 6 が実行されていないことを確認してください。下記のコマンドを使用して、既存の Urchin 6 をすべて無効にします。 <p class="line867"><pre>/path/to/urchin6/bin/urchinctl stop
</pre><ul><li>1 台のコンピュータで複数の Urchin 6 を実行する場合は、（1） Urchin を別の場所にインストールして、（2）別のウェブサーバーのポートを使用し、（3）別のデータベースに接続する必要がございます。 </li><li>Urchin は、必要なファイルをすべて対象のフォルダにコピーして、既存のファイルを上書きします。既存のカスタマイズ設定を残す場合は、Urchin 6 を新しいディレクトリにインストールするか、既存のインストール ディレクトリの名前を変更する必要がございます。 </li><li>Urchin 6.601 は新しくインストールすることも、Urchin 6 の既存のバージョンからアップグレードすることもできます。 <ul><li>Urchin を新しくインストールする場合は、手順に従ってウェブサーバーのポートやデータベース設定などの設定パラメータをすべて指定します。アップグレードする場合は、Urchin 6 の既存の設定が使用されます。 </li><li>Urchin 6.601 は、Urchin 6 の特定のバージョンのみからアップグレードできます。アップグレード可能なバージョンは下記のとおりです。 <ul><li>Urchin 6.6 - 英語版リリース       : バージョン 6.600 </li><li>Urchin 6.5 - Service Pack 2            :   バージョン 6.501 </li><li>Urchin 6.5                             :   バージョン 6.500（上記の注をご確認ください） </li><li>Urchin 6 - Service Pack 1         :   バージョン 6.402 </li><li>Urchin 6 - 国際版リリース :   バージョン 6.401 </li><li>Urchin 6 - 英語版リリース         :   バージョン 6.400 </li></ul></li><li>Urchin を新しくインストールする場合は、データベース テーブルを初期化するようメッセージが表示されます。既存のデータベース設定を残す場合は [いいえ] を選択してください。これにより、Urchin で既存の設定が保持されます（既存のテーブルは再作成されません）。ただし、場合によっては追加のテーブルや既存のテーブルの列を作成する必要がございます。 </li></ul></li><li>Urchin インストーラを実行します。対話形式で実行するには、表示される手順に従い下記のように入力します。 </li></ul><p class="line867"><pre>./install.sh
</pre><p class="line874">または、インストールに必要なすべてのパラメータを指定して、コマンド ラインから直接インストールを完了することもできます。コマンド ラインのパラメータのリストを入手するには、下記のように入力します。 <p class="line867"><pre>./install.sh -h
</pre><ul><li>インストーラが完了すると、システム上で Urchin を実行できるようになります。設定を完了するには、下記の URL で使用するウェブブラウザを指定します。 </li></ul><p class="line867"><pre>http://yourserver:&lt;port&gt;
</pre><p class="line867">&lt;port&gt; はインストール時に選択したネットワーク ポート（デフォルトは 9999）です。 <ul><li>Urchin 6 の以前のバージョンからプロファイルのレポート データを復元するには、history、reports、既存の cpc ディレクトリを /path/to/old-urchin6/data/ から新しい /path/to/new-urchin6/data/ ディレクトリにコピーします。 </li><li>[デモ ライセンスの取得] をクリックし、ライセンス取得の手順に従って Urchin の有効化と初期設定を行います。 </li></ul><p class="line867"><strong>トラッキングの設定</strong> <p class="line874">Urchin をインストールしたら、使用状況に応じてウェブサイトのトラッキングを設定します。 <p class="line867"><strong>使用例 1: Urchin で IP+User-Agent ェントによるトラッキングを行う場合</strong> <p class="line874">その他の設定は必要ございません。Urchin にプロファイルを追加する際、[ユーザーのトラッキング方法] で IP+User-Agent ェントを指定します。 <p class="line867"><strong>使用例 2: Urchin で Urchin トラフィック モニタ（UTM）によるトラッキングを行う場合</strong> <p class="line862">Urchin で Urchin トラフィック モニタ（UTM）によるトラッキングを行う場合、ウェブサイトの各ページに小さな JavaScript トラッキング コードをインストールする必要がございます。手順は下記のとおりです。 <ul><li><p class="line862">Urchin の util/utm ディレクトリにある urchin.js ファイルと <tt class="backtick">__</tt>utm.gif ファイルをウェブサイトのドキュメント ルート（コンテンツの最上位ディレクトリなど）にコピーします。 </li></ul><p class="line874">* ウェブサイトの各ページの HEAD セクションの META タグの直後に、下記のトラッキング コードを入力します。 <p class="line867"><pre>&lt;script src="/urchin.js" type="text/javascript"&gt;
&lt;/script&gt;
&lt;script type="text/javascript"&gt;
  _userv=0;
  urchinTracker();
&lt;/script&gt;
</pre><ul><li>Urchin にプロファイルを追加する際、[ユーザーのトラッキング方法] で Urchin トラフィック モニタ（UTM）を指定します.。 </li></ul><p class="line867"><strong>使用例 3: Urchin と Google Analytics を併用する場合</strong> <p class="line874">Google Analytics の ga.js トラッキング コードの新しいトラッキング機能は、Urchin 6 との下位互換性がございません。Google Analytics と Urchin ソフトウェアの両方でウェブサイトをトラッキングして最適な結果を得るには、urchin.js ベースのトラッキング コードを使用することをおすすめします。ga.js を使用する場合、ga.js の新しいトラッキング機能は使用できません。 <p class="line874">Google Analytics で既にトラッキングしているウェブサイトで Urchin を使用するには、Google Analytics の既存のトラッキング コードを若干変更する必要がございます。手順は下記のとおりです。 <ul><li><p class="line862">Urchin の util/utm ディレクトリにある <tt class="backtick">__</tt>utm.gif ファイルのみをウェブサイトのドキュメント ルート（コンテンツの最上位ディレクトリなど）にコピーします。 </li><li><p class="line862">下記に示すように、行 <tt>_userv=2;</tt> をウェブサイトのページの既存のトラッキング コードに追加します。既存のトラッキング コードの他の部分は絶対に変更しないでください。 </li></ul><p class="line867"><pre>&lt;script src="http://www.google-analytics.com/urchin.js"
type="text/javascript"&gt;
&lt;script type="text/javascript"&gt;
  _userv=2;
  _uacct="UA-XXXXXXX-Y";
  urchinTracker();
&lt;/script&gt;
</pre><ul><li>Urchin にプロファイルを追加する際、[ユーザーのトラッキング方法] で Urchin トラフィック モニタ（UTM）を指定します。 </li></ul></div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>