<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>「(7054-323-317) バックアップが存在しないため、データベースを復旧できません」というエラーが発生した場合の対処方法</strong> <p class="line867"><strong>問題の内容</strong> <p class="line874">Urchin プロファイルの実行中に次のメッセージが表示されます。 <p class="line874">(7050-323-317) Starting automatic rollback + <p class="line874">(7054-323 317) Unable to restore databases since backup does not exist. <p class="line867"><strong>理由</strong> <p class="line874">このエラーは、この Urchin プロファイルが前回実行時に異常終了した場合に発生する可能性があります。 たとえば、「ログ処理エンジン」のプロセス/タスクをシステム管理者が (CLI 画面などから) 手動で終了した場合や、他の予期しない問題が発生して実行中のログ処理が終了した場合、またはシステムの再起動によって処理が正しく終了しなかった場合に発生することがあります。 <p class="line874">異常終了した場合、通常 Urchin では最後に記録された正常な状態のプロファイルにロールバックして安全に復元します。ただし、プロファイルの最初の実行時 (または月の最初の実行時) にプロファイル処理が中断した場合、ロールバックの対象となるバックアップ ファイルは存在しません。 この場合は、Urchin で「データベースを復旧できません」というエラーが発生します。 <p class="line874">技術的には、Urchin のログ処理エンジンでは、処理中のプロファイルの lock.udb ファイルをレポート ディレクトリに作成します。 このファイルは処理が終わるまでロックされ、ログ処理エンジンの 1 つのインスタンスだけがプロファイルの処理を実行できるよう制御しています。 ログ処理エンジンは、起動時に lock.udb ファイルの有無を確認します。 ファイルが存在する場合、ログ処理エンジンは現在のロック状態を確認します。 ファイルが存在しない場合は、前回のプロファイル実行が失敗しているため、ログ処理エンジンは処理を行う前に、プロファイル データベースを最後に記録された正常な状態にロールバックしようとします。 前述したように、ロールバック アーカイブがない場合は、ロールバック エラー メッセージが表示され、ログ処理は終了します。 <p class="line867"><strong>解決方法</strong> <p class="line874">Urchin が前回実行時に異常終了した場合は、その月に処理される Urchin データベースの状態は不明となり、データベースに含まれるデータも正しくチェックポイント処理されません。 このため、その月に処理されるデータをすべて削除する必要があります。 多くの場合、不正な処理実行ではその月の Urchin データのみが作成されるため、正常でないデータも残されます。 <p class="line874">Urchin のプロファイル データをリセットしてプロファイルを引き続き実行できるようにするには、次の手順をご覧ください。 <p class="line867"><span class="u">Windows Systems</span> <ol type="1"><li><p class="line862">DOS Shell を起動します ([スタート] -&gt; [ファイル名を指定して実行] で 「cmd」を入力します)。 </li><li>Urchin のプロファイル データが保存されているフォルダに移動します。通常は次のフォルダになります。 <ul><li style="list-style-type:none">C:\Program Files\Urchin\data\reports\profilename </li></ul></li><li>「TYPE lock.udb」コマンドを使用して lock.udb ファイルの内容を確認します。 「YYYYMM」の日付形式のエントリ (例: 200408) を含む 1 行以上のデータが表示されます。 </li><li>lock.udb ファイルの「YYYYMM」を含む各行に対して、次の手順を行います。 <ul><li>「DEL YYYYMM-*data*」コマンドを使用して、対象の月の Urchin データベースを削除します。 </li><li>「DIR YYYYMM*backup*.zip」コマンドを使用して、対象の月のバックアップ アーカイブの有無を確認します。 バックアップ アーカイブは「YYYYMM-backup-YYYYMMDDHHMMSS.zip」という名前になります (例: 200805-backup-20080331103340.zip)。 </li><li>対象の月のバックアップ ファイルが 1 つ以上存在する場合は、「..\..\..\util\unzip -o -u backupfile.zip」コマンドを使用して、最新のタイムスタンプ付きのバックアップ アーカイブからデータを復旧します (例: ..\..\..\util\unzip -o -u 200805-backup-20080331103340.zip)。 </li></ul></li><li>「DEL lock.udb」コマンドを使用して lock.udb ファイルを削除します。 </li><li>これで、[今すぐ実行] ボタンでプロファイルを再実行できるようになります。 </li></ol><p class="line867"><span class="u">UNIX システム</span> <ol type="1"><li>「root」または Urchin を実行するユーザーでコマンド シェルを開きます。 </li><li>Urchin のプロファイル データが保存されているディレクトリに移動します。たとえば次のように入力します。 <ul><li style="list-style-type:none">cd /usr/local/urchin/data/reports/profilename </li></ul></li><li>「cat lock.udb」コマンドを使用して lock.udb ファイルの内容を表示します。 「YYYYMM」の日付形式のエントリ (例: 200408) を含む 1 行以上のデータが表示されます。 </li><li>lock.udb ファイルの「YYYYMM」を含む各行に対して、次の手順を行います。 <ul><li>「rm YYYYMM-*data*」コマンドを使用して、対象の月の Urchin データベースを削除します。 </li><li>「 <ul><li style="list-style-type:none">ls YYYYMM*backup*.zip」コマンドを使用して、対象の月のバックアップ アーカイブの有無を確認します。 バックアップ アーカイブは「YYYYMM-backup-YYYYMMDDHHMMSS.zip」という名前になります (例: 200803-backup-20080331103340.zip)。 </li></ul></li><li>対象の月のバックアップ ファイルが 1 つ以上存在する場合は、「../../../util/unzip -o -u backupfile.zip」コマンドを使用して、最新のタイムスタンプ付きのバックアップ アーカイブからデータを復旧します (例: ../../../util/unzip -o -u 200803-backup-20080331103340.zip)。 </li></ul></li><li>「rm lock.udb」コマンドを使用して lock.udb ファイルを削除します。 </li><li>これで、[今すぐ実行] ボタンでプロファイルを再実行できるようになります。 </li></ol></div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>