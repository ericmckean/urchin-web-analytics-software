<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>カスタム e コマース ログ</strong> <p class="line867"><strong>概要</strong> <p class="line862">多くのショッピング カートには、購入に関する重要な情報を ELF2 以外の形式で取得、記録できる機能があるため、Urchin では自動的に処理されません。 このセクションでは、ELF2 を生成するようショッピング カートを設定できない場合に、e コマースのログ ファイル向けにカスタムのログ形式を作成する方法を説明します。 その前に、<a href="Custom_Log_Formats.html">カスタム ログ フォーマット</a>でカスタム ログの作成に関する説明をご覧ください。 <p class="line867"><strong>e コマース ログ形式の種類</strong> <p class="line874">ショッピング カートでは、購入や購入商品に関する情報を 1 行または複数行の形式のどちらかで記録できます。 1 行形式の場合は、トランザクションと購入商品について完全に説明するために必要なすべての情報が各行に記録され、すべての行が同じレイアウトになります。 複数行形式の場合は、複数行に購入情報が記録され、トランザクション行とアイテム行は別の形式になります。ELF2 ログは複数行の形式です。 データが 1 行と複数行のどちらで記録されるかは、カスタム ログ フォーマットの設定方法に影響するため、e コマース ログを確認して特定する必要があります。 ログ形式の種類に応じて、次の手順に従ってください。 <p class="line867"><strong>e コマース ログの全般的な要件</strong> <p class="line874">ショッピング カートで作成される各ログ エントリには、形式を問わず、ユーザーを関連付けるため、日時と次のフィールドの少なくとも 1 つが含まれる必要があります。 <ul><li>リモート ホストまたは IP アドレス (IP のみか IP とユーザー エージェントのトラッキング方法の場合) </li><li>ユーザー エージェント (IP とユーザー エージェントのトラッキング方法の場合) </li><li>Cookie (UTM または SID のトラッキング方法の場合) </li><li>セッション ID (SID のトラッキング方法の場合) </li></ul><p class="line874">上記のフィールドのいずれかが不明な場合、Urchin では収益の有効な分析を行うことができません。また Urchin では次の e コマース フィールドも定義されています。 <ul><li>%{ORDERID}: 注文番号 </li><li>%{STORE}: 店舗の名前または ID </li><li>%{SESSIONID}: 顧客の固有のセッション ID </li><li>%{TOTAL}: 税金と配送料を含むトランザクションの合計額 (小数点のみで「$」の文字を除く) </li><li>%{TAX}: 小計の税額 </li><li>%{SHIPPING}: 配送料 </li><li>%{BILL_CITY}: 顧客の請求先の市町村 </li><li>%{BILL_STATE}: 顧客の請求明細 </li><li>%{BILL_ZIP}: 顧客の請求先の郵便番号 </li><li>%{BILL_COUNTRY}: 顧客の請求先の国 </li><li>%{PRODUCT_CODE}: 商品の ID </li><li>%{PRODUCT_NAME}: 商品の名前 </li><li>%{VARIATION}: 色やサイズなど、商品のバリエーション </li><li>%{PRICE}: 商品の単価 (小数点のみで「$」の文字を除く) </li><li>%{QUANTITY}: 商品の注文数 </li><li>%{UPSOLD}: 商品が販売中かどうかを示すブール値 (0|1) </li></ul><p class="line867"><strong>1 行形式のログ</strong> <p class="line874">e コマースのログ ファイルに、上記の説明とすべて同じ形式の行のヒットのみが記録されている場合は、次の手順に従います。 <ol type="1"><li>lib/custom/logformats ディレクトリに custom.lf.sample ログフォーマット ファイルをコピーして、新しいカスタム ログ フォーマットを作成します。 コピーしたファイルの名前には .lf 拡張子を付けます。 </li><li>新しいカスタム ログ フォーマット ファイルを編集し、次のエントリを下記のアドバイスに基づいて設定します。 <ul><li><p class="line891">PrimaryPositions:  ログ ファイルのフィールドの順序を指定します。 カンマ区切りでフィールドの ID のリストを作成し、フィールドの順序を指定します。 フィールドの名前と ID は、lib/reporting/logformats/fieldlist.txt ファイルで確認できます。 下記の例をご覧ください。 </li><li><p class="line891">SecondaryPositions:  1 行形式のログ ファイルでは使用されないため、「-」のままにします。 </li><li><p class="line891">PrimaryKey:  1 行形式のログ ファイルでは使用されないため、「-」のままにします。 </li><li><p class="line891">SecondaryKey:  1 行形式のログ ファイルでは使用されないため、「-」のままにします。 </li><li><p class="line891">PrimaryContent:  このフィールドで使用できるエントリは「TRANSACTION」または「ITEM」です。 ログ ファイルのヒットが個々の商品の購入を示している場合は、「ITEM」に設定します。 ログ ファイルのヒットが全体的な購入情報を示している場合は、「TRANSACTION」に設定します。 </li><li><p class="line891">SecondaryContent:  1 行形式のログ ファイルでは使用されないため、「-」のままにします。 </li><li><p class="line891">CommentKey:  ログ ファイルにコメント行またはヒットとして扱わない行があり、これらの行が特定の文字で始まっている場合は、ここに文字を入力します。 </li><li><p class="line891">FieldSeparator1:  フィールドの区切りとして扱う文字を定義します。 一般的なエントリは、タブ (\t) とスペース (\s) です。 ログ ファイルのフィールド間の文字に応じて設定します。 </li><li><p class="line891">FieldSeparator2:  上記の FieldSeparator1 をご覧ください。 </li><li><p class="line891">QuotesEscapeSep:  引用符 "" を含むフィールドの内側でフィールドの区切りを無視するかどうかを指定します。 通常は「YES」のままにしておきます。 </li><li><p class="line891">BracketsEscapeSep:  角かっこ [] を含むフィールドの内側でフィールドの区切りを無視するかどうかを指定します。 通常は「YES」のままにしておきます。 </li><li><p class="line891">MergSuccessiveSep:  1 行に 2 つの区切り文字がある場合、1 つの区切り文字と見なすかどうかを指定します。 通常は「NO」のままにしておきます。 </li><li><p class="line891">CleanWhiteSpace:  解析時にフィールド末尾の空白を削除するかどうかを指定します。 通常は「NO」のままにしておきます。 </li><li><p class="line891">StatusRequired:  ヒットにウェブサーバー タイプのステータス コードが含まれない場合は、「NO」のままにしておきます。 </li><li><p class="line891">CustomDateFormat:  ログ形式にカスタムの日付形式が含まれる場合は、エントリの strptime 形式を設定します。 </li><li><p class="line891">CustomTimeFormat:  ログ形式にカスタムの時間形式が含まれる場合は、エントリの strptime 形式を設定します。 </li></ul></li><li>カスタム ログ フォーマットを lib/custom/logformats ディレクトリに保存します。 </li><li>Urchin Admin インターフェースでログ ソースのカスタム ログ フォーマットを選択します。 </li><li>ログ ファイルを Urchin で処理します。 </li></ol><p class="line867"><strong>1 行形式の例</strong> <p class="line874">トランザクション データのみを含むログのヒットの例を次に示します。 <p class="line867"><pre>12345 123.123.123.123 "Urchin Store" [26/Aug/2003:11:43:02 -0700] 192.73 "San Diego" "CA" 92101 "US" "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;)" "utma=171060324.2734232095.1061444425.1061444425.1061444763.2"
</pre><p class="line862">下記のリストに各フィールド名と lib/reporting/logformats/fieldslist.txt ファイルから取得される ID 番号を示します。 カスタム ログ フォーマット ファイルの PrimaryPositions フィールドでは、この割り当てられた ID 番号を使用します。 <ol type="1"><li>トランザクション ID 25 </li><li>リモート ホストまたは IP アドレス 12 </li><li>ショップ名 26 </li><li>Apache 日付/時間 3 </li><li>合計料金 28 </li><li>請求先の都市 31 </li><li>請求先の都道府県 32 </li><li>請求先の郵便番号 33 </li><li>請求先の国 34 </li><li class="gap">ユーザー エージェント 13 </li><li>Cookies 14 </li></ol><p class="line874">上記のリストに基づいて、カスタム ログ フォーマット ファイルで次のエントリを設定します。 <p class="line867"><pre>PrimaryPositions: "25, 12, 26, 3, 28, 31, 32, 33, 34, 13, 14" SecondaryPositions: - PrimaryKey: - SecondaryKey: - PrimaryContent: TRANSACTION SecondaryContent: - CommentKey: # FieldSeparator1: \s FieldSeparator2: \t QuotesEscapeSep: YES BracketsEscapeSep: YES MergSuccessiveSep: NO CleanWhiteSpace: NO StatusRequired: NO CustomDateFormat: - CustomTimeFormat: -
</pre><p class="line867">PrimaryPositions でフィールドの順序を指定し、PrimaryContent でこのログにトランザクション (または購入に関する全般的な情報) が含まれることを Urchin  に通知します。 フィールドは空白で区切られるため、フィールドの区切り文字はスペースとタブに設定されています。 日付/時間は Apache の日付としてフォーマットされるため、カスタムの日付/時間形式は指定されていません。 <p class="line867"><strong>複数行形式のログ</strong> <p class="line874">Urchin では、各行が特定の文字で始まっていて、どの形式が使用されているか識別できる場合は、複数行形式を読み取ることができます。 たとえば、ELF2 ログ ファイルでは、トランザクション行が感嘆符の「!」で始まります。 アイテム行は「!」の文字で始まりません。 <p class="line874">e コマースのログ ファイルに、トランザクション行と商品またはアイテム行という 2 種類の行が含まれる場合は、次の手順に従います。 <ol type="1"><li>lib/custom/logformats ディレクトリに custom.lf.sample ログフォーマット ファイルをコピーして、新しいカスタム ログ フォーマットを作成します。 コピーしたファイルの名前には .lf 拡張子を付けます。 </li><li>新しいカスタム ログ フォーマット ファイルを編集し、次のエントリを下記のアドバイスに基づいて設定します。 <ul><li><p class="line891">PrimaryPositions:  ログ ファイルのフィールドの順序を指定します。 カンマ区切りでフィールドの ID のリストを作成し、フィールドの順序を指定します。 フィールドの名前と ID は、lib/reporting/logformats/fieldlist.txt ファイルで確認できます。 </li><li><p class="line891">SecondaryPositions:  ログ ファイルのフィールドの順序を指定します。 カンマ区切りでフィールドの ID のリストを作成し、フィールドの順序を指定します。 フィールドの名前と ID は、lib/reporting/logformats/fieldlist.txt ファイルで確認できます。 </li><li><p class="line891">PrimaryKey:  PrimaryPositions で指定した形式のログ ファイル行を識別する文字を設定します。 </li><li><p class="line891">SecondaryKey:  SecondaryPositions で指定した形式のログ ファイル行を識別する文字を設定します。 </li><li><p class="line891">PrimaryContent:  このフィールドで使用できるエントリは「TRANSACTION」または「ITEM」です。 ログ ファイルのヒットが個々の商品の購入を表している場合は、「ITEM」に設定します。 ログ ファイルのヒットが全体的な購入情報を表している場合は、「TRANSACTION」に設定します。 </li><li><p class="line891">SecondaryContent:  上記の PrimaryContent をご覧ください。 </li><li><p class="line891">CommentKey:  ログ ファイルにコメント行またはヒットとして扱わない行があり、これらの行が特定の文字で始まっている場合は、ここに文字を入力します。 </li><li><p class="line891">FieldSeparator1:  フィールドの区切りとして扱う文字を定義します。 一般的なエントリは、タブ (\t) とスペース (\s) です。 ログ ファイルのフィールド間の文字に応じて設定します。 </li><li><p class="line891">FieldSeparator2:  上記の FieldSeparator1 をご覧ください。 </li><li><p class="line891">QuotesEscapeSep:  引用符 "" を含むフィールドの内側でフィールドの区切りを無視するかどうかを指定します。 通常は「YES」のままにしておきます。 </li><li><p class="line891">BracketsEscapeSep:  角かっこ [] を含むフィールドの内側でフィールドの区切りを無視するかどうかを指定します。 通常は「YES」のままにしておきます。 </li><li><p class="line891">MergSuccessiveSep:  1 行に 2 つの区切り文字がある場合、1 つの区切り文字と見なすかどうかを指定します。 通常は「NO」のままにしておきます。 </li><li><p class="line891">CleanWhiteSpace:  解析時にフィールド末尾の空白を削除するかどうかを指定します。 通常は「NO」のままにしておきます。 </li><li><p class="line891">StatusRequired:  ヒットにウェブサーバー タイプのステータス コードが含まれない場合は、「NO」のままにしておきます。 </li><li><p class="line891">CustomDateFormat:  ログ形式にカスタムの日付形式が含まれる場合は、エントリの strptime 形式を設定します。 </li><li><p class="line891">CustomTimeFormat:  ログ形式にカスタムの時間形式が含まれる場合は、エントリの strptime 形式を設定します。 </li></ul></li><li>カスタム ログ フォーマットを lib/custom/logformats ディレクトリに保存します。 </li><li>Urchin Admin インターフェースでログ ソースのカスタム ログ フォーマットを選択します。 </li><li>Urchin でログ ファイルを処理します。 </li></ol></div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>