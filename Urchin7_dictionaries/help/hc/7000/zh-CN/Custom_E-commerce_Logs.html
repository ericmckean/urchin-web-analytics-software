<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>自定义电子商务日志</strong> <p class="line867"><strong>概述</strong> <p class="line862">许多购物车可以通过非 ELF2 的格式来捕获和记录与购买相关的重要信息，因此不能由 Urchin 自动处理。本文阐述了在您无法更改购物车以生成 ELF2 格式时，应如何为电子商务日志文件创建自定义日志格式。在继续之前，请首先阅读 <a href="Custom_Log_Formats.html">自定义日志格式</a>，其中有自定义日志的详细创建说明。 <p class="line867"><strong>电子商务日志格式类型</strong> <p class="line874">购物车能够采用单行或多行的格式，记录与购买相关的信息和所购买的项目。在单行格式中，每一行都包含所有必要的信息，可以完整地说明相关的交易及购买的项目，同时，所有行的格式相同。在多行格式中，一次购买事件采用多行描述。"交易"行是一种格式，"购买的项目"行是另一种格式。ELF2 日志为多行格式。您需要检查电子商务日志，弄清楚数据是单行还是多行格式，因为这会影响您设置自定义日志格式的方式。请根据您日志格式的类型，按照下列说明进行操作。 <p class="line867"><strong>一般的电子商务日志要求</strong> <p class="line874">无论您的购物车生成的日志条目为何种格式，每个条目都必须包括日期和时间，还必须至少包括下列提供访问者关联信息的字段之一： <ul><li>远程主机或 IP 地址（用于"仅限 IP"或"IP-Useragent"访问者方法） </li><li>Useragent（用于 IP-Useragent 访问者方法） </li><li>Cookies（用于 UTM 或 SID 访问者方法） </li><li>会话 ID（用于 SID 访问者方法） </li></ul><p class="line874">如果上述字段都缺失，Urchin 生成的有关您收入的分析将没有意义。Urchin 还会定义下列电子商务字段： <ul><li>%{ORDERID} 是订单号 </li><li>%{STORE} 是商店的名称/ID </li><li>%{SESSIONID} 是客户唯一的会话标识符 </li><li>%{TOTAL} 是交易总额，包括税款和运费（仅使用十进制数，不包括 '$' 字符） </li><li>%{TAX} 是计入小计的税额 </li><li>%{SHIPPING} 是运费金额 </li><li>%{BILL_CITY} 是客户的结算城市 </li><li>%{BILL_STATE} 是客户的结算州/省 </li><li>%{BILL_ZIP} 是客户的结算邮编 </li><li>%{BILL_COUNTRY} 是客户的结算国家/地区 </li><li>%{PRODUCT_CODE} 是产品的标识符 </li><li>%{PRODUCT_NAME} 是产品名称 </li><li>%{VARIATION} 是产品的可选变量，例如颜色、大小等 </li><li>%{PRICE} 是产品单价（仅使用十进制数，不包括 '$' 字符） </li><li>%{QUANTITY} 是产品的订购量 </li><li>%{UPSOLD} 是产品是否有售的布尔值 (0|1) </li></ul><p class="line867"><strong>单行格式日志</strong> <p class="line874">如果像上文所述，您电子商务日志文件中的所有点击信息都具有相同的行格式，那么请按下列说明操作。 <ol type="1"><li>通过复制 custom.lf.sample 日志格式文件，在 lib/custom/logformats 目录中创建新的自定义日志格式。用 a .lf 后缀为复制的日志文件命名。 </li><li>请对您新的自定义日志格式文件进行编辑，并根据以下建议设定相关条目： <ul><li><p class="line891">PrimaryPositions：此条目可指定您日志文件中的字段顺序。创建以逗号分隔的字段 ID（指明了字段顺序）列表。字段名称和 ID 可在 lib/reporting/logformats/fieldlist.txt 文件中找到。请查看以下示例。 </li><li><p class="line891">SecondaryPositions：将此条目留为 '-'，因为它不用于单行格式的日志文件。 </li><li><p class="line891">PrimaryKey：将此条目留为 '-'，因为它不用于单行格式的日志文件。 </li><li><p class="line891">SecondaryKey：将此条目留为 '-'，因为它不用于单行格式的日志文件。 </li><li><p class="line891">PrimaryContent：此字段的有效输入内容是 TRANSACTION 或 ITEM。如果您日志文件中的点击信息描述了单个项目的购买情况，请将此条目设为 ITEM。如果您日志文件中的点击信息描述了所有项目的购买情况，请将此条目设为 TRANSACTION。 </li><li><p class="line891">SecondaryContent：将此条目留为 '-'，因为它不用于单行格式日志文件。 </li><li><p class="line891">CommentKey：如果您日志文件中的某些行是评论，而不是点击信息，同时还以特定字符开头，请在此处输入这些字符。 </li><li><p class="line891">FieldSeparator1：字段分隔符界定了可被用作字段分隔符的字符。通常，字段分隔符包括 tab 字符 (\t) 和空格字符 (\s)。根据您日志文件中字段之间的字符，设置恰当的字段分隔符。 </li><li><p class="line891">FieldSeparator2：同 FieldSeparator1 </li><li><p class="line891">QuotesEscapeSep：此字段指明了在含有引号 "" 字符的字段中，字段分隔符是否会被忽略。此字段通常应被留为 YES。 </li><li><p class="line891">BracketsEscapeSep：此字段指明了在含有括号 [] 字符的字段中，字段分隔符是否会被忽略。此字段通常应被留为 YES。 </li><li><p class="line891">MergSuccessiveSep：此字段指明了是否将连续出现的两个字段分隔符看作一个分隔符。此字段通常应被留为 NO。 </li><li><p class="line891">CleanWhiteSpace：此字段指明了在解析字段时，是否删除字段末尾的空白区域。此字段通常应被留为 NO。 </li><li><p class="line891">StatusRequired：将此字段设为 NO，除非您日志文件中的点击信息包含网络服务器类型状态代码 </li><li><p class="line891">CustomDateFormat：如果您的日志格式包含自定义日期格式，请设置恰当描述此日期格式所在条目的 strptime 格式 </li><li><p class="line891">CustomTimeFormat：如果您的日志格式包含自定义时间格式，请设置恰当描述此时间格式所在条目的 strptime 格式 </li></ul></li><li>将您的自定义日志格式保存到 lib/custom/logformats 目录中 </li><li>在 Urchin Admin 界面中为您的日志源选择自定义日志格式 </li><li>用 Urchin 处理您的日志文件 </li></ol><p class="line867"><strong>单行格式示例</strong> <p class="line874">以下示例是日志中的一条点击信息，仅包括交易数据。 <p class="line867"><pre>12345 123.123.123.123 "Urchin Store" [26/Aug/2003:11:43:02 -0700] 192.73 "San Diego" "CA" 92101 "US" "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;)" "utma=171060324.2734232095.1061444425.1061444425.1061444763.2"
</pre><p class="line862">以下列表显示了从 lib/reporting/logformats/fieldslist.txt 文件取得的字段名称及相应 ID 号。以此方式分配的 ID 号用于您自定义日志格式文件中的 PrimaryPositions 字段。 <ol type="1"><li>交易 ID 25 </li><li>远程主机或 IP 地址 12 </li><li>商店名称 26 </li><li>Apache 日期/时间 3 </li><li>总费用 28 </li><li>结算城市 31 </li><li>结算州/省 32 </li><li>结算邮编 33 </li><li>结算国家/地区 34 </li><li class="gap">用户代理 13 </li><li>Cookies 14 </li></ol><p class="line874">您可以根据上述列表在自定义日志格式文件中设置下列条目： <p class="line867"><pre>PrimaryPositions: "25, 12, 26, 3, 28, 31, 32, 33, 34, 13, 14" SecondaryPositions: - PrimaryKey: - SecondaryKey: - PrimaryContent: TRANSACTION SecondaryContent: - CommentKey: # FieldSeparator1: \s FieldSeparator2: \t QuotesEscapeSep: YES BracketsEscapeSep: YES MergSuccessiveSep: NO CleanWhiteSpace: NO StatusRequired: NO CustomDateFormat: - CustomTimeFormat: -
</pre><p class="line867">PrimaryPositions 指定字段顺序，PrimaryContent 告诉 Urchin 此日志包含交易信息（或者有关购买的一般信息）。字段分隔符设为空白字符和 tab 字符，这是因为字段由空白区域分开。由于日期/时间格式为 Apache 日期格式，因此未指定自定义日期/时间格式。 <p class="line867"><strong>多行格式日志</strong> <p class="line874">只要每行开头的字符包含能够指明该行所用格式的特定字符，Urchin 就能阅读多行格式的文件。例如，ELF2 日志文件中的"交易"行将叹号 '!' 作为第一个字符。而"项目"行则不包括前导字符 '!'。 <p class="line874">如果您的电子商务日志文件包含两个不同的格式行，一个为"交易"行，另一个为"产品或项目详细信息"行，那么请按以下说明进行操作。 <ol type="1"><li>通过复制 custom.lf.sample 日志格式文件，在 lib/custom/logformats 目录中创建新的自定义日志格式。用 a .lf 后缀为复制的日志文件命名。 </li><li>对新的自定义日志格式文件进行编辑，并根据以下建议设定相关条目： <ul><li><p class="line891">PrimaryPositions：此条目可指定您日志文件中的字段顺序。创建以逗号分隔的字段 ID（指明了字段顺序）列表。字段名称和 ID 可在 lib/reporting/logformats/fieldlist.txt 文件中找到。 </li><li><p class="line891">SecondaryPositions：此条目可指定您日志文件中的字段顺序。创建以逗号分隔的字段 ID（指明了字段顺序）列表。字段名称和 ID 可在 lib/reporting/logformats/fieldlist.txt 文件中找到。 </li><li><p class="line891">PrimaryKey：设置主键字符，该字符可将日志文件行标识为与 primarypositions 所描述的格式相同 </li><li><p class="line891">SecondaryKey：设置次键字符，该字符可将日志文件行标识为与 secondarypositions 所描述的格式相同 </li><li><p class="line891">PrimaryContent：此字段的有效输入内容是 TRANSACTION 或 ITEM。如果您日志文件中的点击信息描述了单个项目的购买情况，请将此条目设为 ITEM。如果您日志文件中的点击信息描述了所有项目的购买情况，请将此条目设为 TRANSACTION。 </li><li><p class="line891">SecondaryContent：同 PrimaryContent </li><li><p class="line891">CommentKey：如果您日志文件中的某些行是评论，而不是点击信息，同时还以特定字符开头，请在此处输入这些字符。 </li><li><p class="line891">FieldSeparator1：字段分隔符界定了被视作字段分隔符的字符。通常，字段分隔符包括 tab 字符 (\t) 和空格字符 (\s)。根据您日志文件中字段之间的字符，设置恰当的字段分隔符。 </li><li><p class="line891">FieldSeparator2：同 FieldSeparator1 </li><li><p class="line891">QuotesEscapeSep：此字段指明了在含有引号 "" 字符的字段中，字段分隔符是否会被忽略。此字段通常应被留为 YES。 </li><li><p class="line891">BracketsEscapeSep：此字段指明了在含有括号 [] 字符的字段中，字段分隔符是否会被忽略。此字段通常应被留为 YES。 </li><li><p class="line891">MergSuccessiveSep：此字段指明了是否将连续出现的两个字段分隔符看作一个分隔符。此字段通常应被留为 NO。 </li><li><p class="line891">CleanWhiteSpace：此字段指明了在解析字段时，是否删除字段末尾的空白区域。此字段通常应被留为 NO。 </li><li><p class="line891">StatusRequired：除非您日志文件中的点击信息包含网络服务器类型状态代码，否则将此字段设为 NO </li><li><p class="line891">CustomDateFormat：如果您的日志格式包含自定义日期格式，请设置恰当描述此日期格式所在条目的 strptime 格式 </li><li><p class="line891">CustomTimeFormat：如果您的日志格式包含自定义时间格式，请设置恰当描述此时间格式所在条目的 strptime 格式 </li></ul></li><li>将您的自定义日志格式保存到 lib/custom/logformats 目录中 </li><li>在 Urchin Admin 界面中为您的日志源选择自定义日志格式 </li><li>用 Urchin 处理您的日志文件 </li></ol></div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>