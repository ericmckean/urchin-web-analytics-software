<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>日志轮换最佳实践</strong> <p class="line867"><strong>概述</strong> <p class="line874">大部分操作环境都会由系统服务与应用程序（如网络服务器）生成记录与服务相关的操作和活动的日志文件。多数情况下，操作系统和/或应用程序也会对日志文件定期进行维护，以限制日志文件的大小。这样做可以防止出现因日志文件无限增长而最终消耗掉全部硬盘空间的问题。 <p class="line874">管理日志的常见方式是安排定期的日志轮换任务：加上时间戳，重命名现有日志，然后重新启用服务或应用程序，即可开始使用长度为零的新日志文件。另一种标准的日志轮换方式是压缩旧的日志文件，在一段年限或到达轮换周期阈值时，删除日志文件。 <p class="line874">针对网络服务器日志的特殊情况，通常会以每天为基础进行轮换，以将日志大小控制在适当的范围内。此外，每天安排进行轮换，通常还可为使用 Urchin 等分析工具进行网络服务器日志的后处理打下良好的基础。部分网络服务器（如 Microsoft 的 IIS）设有内置的日志轮换功能，启用此功能时，默认情况下会每天轮换日志。其他网络服务器（如 Apache）虽然没有明确的日志轮换处理器，但提供了便于重新启动网络服务器（而不会中断网络服务）的工具，以适应日志轮换操作（例如 apachectl restart）。 <p class="line867"><strong>日志轮换实践</strong> <p class="line874">Urchin 的"日志跟踪"技术避免了日志轮换中重复处理日志的问题。这样做可大幅提高 Urchin 处理日志的灵活性，例如处理网络服务器仍在写入的"活动"日志的能力，或处理手动或不定期轮换的日志的能力。 <p class="line867"><strong>重要注意事项：</strong> 与 Urchin 先前的部分版本不同，Urchin 6 不提供调用日志轮换程序的挂钩机制，也不提供执行日志轮换任务后重新启动网络服务器的挂钩机制，不过它可以完成特定的日志后处理操作，如下所述。 <p class="line874">尽管 Urchin 6 的操作不要求定期轮换或全面轮换网络服务器日志，但仍建议您采用标准日志轮换机制，以确保操作顺畅，同时避免"日志跟踪"实用程序进行大量不必要的处理。无论是从系统还是从应用程序的角度来看，管理数个较小的日志都比管理一个大型日志更有效率，因为文件的操作速度会随着文件大小的增长而大幅趋缓。较小的文件也比较容易进行备份，若硬盘或其他系统出现故障也比较容易恢复。 <p class="line874">日志轮换机制不需要过于复杂：多数情况下，只需每天从 UNIX 类型系统的 cron 运行简单的 Shell 脚本或 Perl 脚本即可。脚本只需要轮换现有网络服务器日志并加上时间戳（建议使用 %Y%m%d 或 YYYYMMDD 格式），然后重新启动网络服务器即可。也可添加其他逻辑以清除旧的日志文件，这样可以约束对硬盘空间的使用。 <p class="line867"><strong>配置 Urchin 以进行日志轮换</strong> <p class="line862">日志轮换机制就位之后，配置 Urchin 以处理轮换日志可谓易如反掌。可设置"日志文件路径"规范，在配置日志源时使用与时间戳日志文件名模式相匹配的通配符（例如 access-log.* 适用于 Apache 日志或 ex*.log 适用于 IIS 日志），也可使用 Urchin 内置的时间戳模式匹配（例如 access-log.%Y%m%d 适用于 Apache、ex%y%m%d.log 适用于 IIS）。Urchin 遇到此模式时，会针对 %Y%m%d 模式替代昨天的日期，并使用替代后的文件名处理日志（例如 access-log.20020617）。有关日期匹配模式的详细信息，请参阅 日志路径中的通配符与日期替代。 <p class="line874">通配符规范有其优势，能让您在单个目录内放置多个未处理的日志，并要求 Urchin 在下次运行时进行处理。如果因远程网络服务器崩溃或网络连接中断等情况导致在 Urchin 运行时所需日志文件尚未就位，采用此方法即可非常方便地处理。劣势之处在于：Urchin 必须打开目录并搜索各日志文件，才能判断文件是否已得到处理。若目录中有大量日志文件，这样做可能会带来庞大的负担。如果您认为自己的日志轮换机制可以信赖，使用 YYYYMMDD 模式匹配机制效率更高。 <p class="line862">您也可能希望 Urchin 6 在完成日志文件处理后，就对日志文件进行删除或存档/压缩。可在日志源的"高级设置"中设置不同的"日志处置"选项。有关这些"日志处置"设置的详情，请参阅 日志管理。 <p class="line867"><strong>重要提示！</strong> 尚未轮换且正在运行的日志不应使用"日志处置"选项！ <p class="line867"><strong>在 UNIX 类型的系统上配置日志轮换</strong> <p class="line874">因为操作系统的功能及网络服务器的配置变化多端，同时日志轮换程序很可能仅适用于特定网站，所以在 UNIX-type 系统上建立网络服务器日志轮换机制时并无万能术可供参考。 <p class="line867"><strong>针对 Windows IIS Webserver 配置日志轮换</strong> <p class="line874">如前所述，IIS 的管理功能可让网络服务器日志自动实现日志轮换，不过默认情况下并未启用此功能。请按照下列步骤配置适当的 IIS 网络服务器日志轮换方式。建议您每天对日志进行轮换，同时要依照当地时间进行日志轮换。默认情况下，IIS 会在 GMT 午夜时分进行轮换，而不是按当地时间轮换。 <p class="line874">在 Windows 2000 下，您应确保对 IIS 网络服务器正确配置了日志轮换方式。可利用 Windows 2000 的"计算机管理"功能完成这项配置。Windows NT、Windows XP 与 Windows 2003 服务器均采用类似程序。要打开"计算机管理"并建立日志轮换机制，请执行下列操作： <ul><li><p class="line862">点击"开始"-&gt;"设置"-&gt;"控制面板" </li><li>双击"管理工具" </li><li>双击"计算机管理" </li><li>双击"Internet 信息服务" </li><li>右键点击"默认网站"，然后选择"属性" </li><li>在弹出的窗口中，选择"网站"标签 </li><li>点击该窗口底部的"属性"标签 </li><li>点击"新日志时间段"标题下方的"每天"单选按钮 </li><li>点击"文件命名和创建使用当地时间"复选框 </li></ul><p class="line874">这样做能确保 IIS 在每天午夜过后，立即轮换网络服务器的日志 </div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>