<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>日志路径中的通配符与日期替代</strong> <p class="line867"><strong>概述</strong> <p class="line874">Urchin 能让您在日志文件路径中指定通配符与日期匹配变量。执行 Urchin 任务并读取日志路径时，会对这些变量进行转换，并与您系统中的目录和文件名比较匹配情况。 <p class="line874">Urchin 6 中的日期匹配功能比以前的 Urchin 版本所提供的功能更全面，如下所述： <ul><li>日期替代可以出现在日志文件路径名的任何地方；Urchin 以前的版本仅允许在实际文件名规范中使用替代字符 </li><li>现在采用了更强大且更灵活的数据模式匹配算法，不过，仍支持以前的 YYYYMMDD 样式模式匹配，以实现后向兼容 </li></ul><p class="line874">最常用的时间匹配变量和格式如下所示。本文结尾还列出了所有支持的时间格式变量。 <p class="line874">* 星号匹配 0 个或多个连续字符 2 位的月中日期数字替换了 DD，例如 01-31 %d 等同于 DD 2 位的月份数字替换了 MM，例如 01-12 %m 等同于 MM 2 位的年份数字替换了 YY，例如 01-99 4 位的年份数字替换了 YYYY，例如 0001-2003 %Y 等同于 YYYY <p class="line874">请注意，此环境中星号的工作方式类似于 UNIX 或 DOS 中命令 Shell 的文件名匹配方式，不同于正则表达式的匹配方式：此字符是与前导字符的 0 个或多个实例相匹配。用户能够随意合并这些变量。 <p class="line874">下表举例说明了这些变量的实例如何转译 08/13/2003。请注意，日期说明符 DD 和 %d 会转换为 13 的前一天。 <ul><li>YYYYMMDD 会转译为 20030812 </li><li>%Y-%m-%d 会转译为 2003-08-12 </li><li>%Y/%m/%d 会转译为 2003/08/12（请注意此值在路径中有其隐含意义） </li><li>*YYYYMMDD 会匹配结尾字符串为 20030812 的所有文件名 </li></ul><p class="line874">默认情况下日期说明符 DD 和 %d 会转换为前一天，这与对网络服务器日志及 Urchin 的典型处理方式有关。日志通常每天轮换，以防止日志文件过大，因此每个日志主要都是包含单日数据。日志通常都是快到午夜时轮换，Urchin 则通常在午夜过后（即到了该月的下一天）才会进行处理。如果希望在轮换时将 YYYYMMDD 样式时间戳添加到日志文件名，那么该日期与 Urchin 运行时间之间会有一天的差异。按照 Urchin 的运行时间对日期转换求值会导致无法找到正确的日志名称，因为日志时间戳会读取 20030812，但 Urchin 于 20030813 运行。 <p class="line874">虽然这是最常见的日志管理模式，但并非唯一选择。可采用 Urchin 所提供的配置参数对将这些变量解析为特定日期的方式加以控制。"在日志路径名称中使用替代日期/时间通配符"设置可用来调节控制 DD 与 %d 求值方式的时间差。本文结尾会更详细地说明这项设置。 <p class="line874">年份、月份和日期变量既可用于日志文件名，也可用于日志文件的目录/文件夹路径。星号则只能用于日志文件路径的文件名部分。另外，时间格式变量可在日志源路径中重复使用，但星号只能使用一次。"步骤"部分中的示例有助于向您澄清此概念。 <p class="line867"><strong>步骤</strong> <p class="line874">创建或修改日志源时，应使用"日志设置"标签下"日志文件路径"框内所用路径的时间变量。举例来说，典型的 Apache 网络服务器每日日志轮换机制会创建包含日期戳的日志，日期戳表示日志条目的日期。例如在 07/16/2002 午夜过后 1 分钟时，日志轮换机制进行了日志存档： <pre>/var/log/httpd/access.log
</pre><p class="line874">并将日志保存为 <pre>/var/log/httpd/access.log.20020715
</pre><p class="line874">要在 Urchin 配置文件的日志源中匹配此模式，只要在"日志文件路径"中指定 <pre>/var/log/httpd/access.log.YYYYMMDD
</pre><p class="line874">即可，Urchin 在运行该日期时会自动查找前一天的日志。另举一个例子，当 Microsoft 的 IIS 网络服务器配置为每天轮换日志时，它会为日志文件命名并在文件名中包含当前日期，例如 ex021127.log。因此，要处理每天的 IIS 日志，需要在配置文件日志源的"日志文件路径"字段中使用以下日志文件规范： <pre>C:\WINNT\System32\LogFiles\W3SVC1\exYYMMDD.log
</pre><p class="line874">。 <p class="line874">要允许 Urchin 处理轮换周期短于一天的日志，可合并使用 YYYYMMDD 语法与通配符，以匹配前一天创建的所有日志文件。这样做时需要确保轮换日志文件命名方式的一致性，例如在文件名后附加小时，这就需要在"日志文件路径"规范中使用以下模式： <pre>/var/log/httpd/access.log.YYYYMMDD*
</pre><p class="line874">或 <pre>C:\WINNT\System32\LogFiles\W3SVC1\exYYMMDD*.log
</pre><p class="line874">若日志存放在命名中反映年份、月份和日期的目录中，就需要采取更复杂的应用方式。假设以下是用来存放日志的目录路径： <pre>/logs/2003/07
/logs/2003/08
/logs/2003/09
</pre><p class="line874">并且您将特定月份的所有日志都存放在对应的目录中，且每个日志名称后都附加了该月份的日期（例如 access.log.01、access.log.02）。要允许 Urchin 找出要处理的日志，可使用以下日志路径格式之一： <pre>/logs/YYYY/MM/access.log.DD
/logs/%Y/%M/access.log.%d
</pre><p class="line874">到了处理日志的时间，Urchin 就会处理所有与昨天日期模式相匹配的日志，无论其后缀是什么。对于"日志文件路径"字段规范中对通配符的任何使用方式，都一定要启用配置文件的"日志跟踪"，借此确保 Urchin 不重复处理日志。 <p class="line867"><strong>注意事项</strong> <p class="line874">Urchin 会以当地时间为依据，用当前时间减去 24 小时，判断替换模式的日期。它会正确处理月份和年份的界限。不过，可使用日志源"高级设置"标签下方的"在日志路径名称中使用替代日期/时间通配符"设置加以修改。可选择当地时间或 GMT 时间作为时间调整的依据，然后使用"小时"编辑框以小时为单位指定加减时差。 <p class="line867"><strong>完整的日期与时间格式参考</strong> <p class="line874">以下是所支持的时间格式变量的完整列表，变量遵循标准 C 库 strftime() 例程中所用的惯例： <ul><li>%A = 工作日完整名称的国标表示方式。 </li><li>%a = 工作日缩写名称的国标表示方式。 </li><li>%B = 月份完整名称的国标表示方式。 </li><li>%b = 月份缩写名称的国标表示方式。 </li><li>%d = 月中的天以十进制数字表示 (01-31)。 </li><li>%e = 月中的天以十进制数字表示 (1-31)；如果只有一位数字，前面请留空。 </li><li>%H = 小时（24 小时制）以十进制数字表示 (00-23)。 </li><li>%I = 小时（12 小时制）以十进制数字表示 (01-12)。 </li><li>%j = 年中的天以十进制数字表示 (001-366)。 </li><li>%k = 小时（24 小时制）以十进制数字表示 (0-23)；如果只有一位数字，前面请留空白。 </li><li>%l = 小时（12 小时制）以十进制数字表示 (1-12)；如果只有一位数字，前面请留空白。 </li><li>%M = 分钟以十进制数字表示 (00-59)。 </li><li>%m = 月份以十进制数字表示 (01-12)。 </li><li>%p = "上午"或"下午"的相应国标表示方式。 </li><li>%S = 秒数以十进制数字表示 (00-60)。 </li><li>%s = 自 UTC（世界标准时间）Epoch 以来的秒数（请参阅 mktime(3)）。 </li><li>%w = 周中的天（星期日是一周的第一天）以十进制数字表示 (0-6)。 </li><li>%Y = 年份（含世纪）以十进制数字表示。 </li><li>%y = 年份（不含世纪）以十进制数字表示 (00-99)。 </li><li>%z = 与世界标准时间 (UTC) 的时差，开头的加号代表 UTC 的东侧，减号代表 UTC 的西侧，接下来的小时和分钟分别为两位数字，且中间没有分隔符（RFC 822 日期标题的常见形式）。 </li><li>%% = `%'. （适用于日期/时间条目中需要字面上的百分号时） </li></ul></div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>