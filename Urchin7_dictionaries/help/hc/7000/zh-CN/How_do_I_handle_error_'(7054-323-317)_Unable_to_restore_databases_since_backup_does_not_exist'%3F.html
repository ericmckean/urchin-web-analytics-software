<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>如何处理错误'(7054-323-317) 由于不存在备份，无法恢复数据库'？</strong> <p class="line867"><strong>问题说明</strong> <p class="line874">运行 Urchin 配置文件时，看到以下消息： <p class="line874">(7050-323-317) Starting automatic rollback + <p class="line874">(7054-323 317) Unable to restore databases since backup does not exist. <p class="line867"><strong>原因</strong> <p class="line874">如果此 Urchin 配置文件在上一次运行时被异常终止，则可能会导致发生此错误。在以下情况下会发生异常终止：系统管理员（从控制台命令行界面等处）手动终止'日志处理引擎'进程/任务；终止正在运行的日志处理时发生其他异常问题；系统重新启动并且未正确完成此进程。 <p class="line874">通常，Urchin 能够通过回滚到上一次已知的正确配置文件状态自然地从异常终止中恢复；不过，如果在第一次运行配置文件（或某月的第一次运行）时终止了配置文件处理，则不存在可回滚到的备份文件。在这种情况下，Urchin 会显示"无法恢复数据库"错误。 <p class="line874">从更深的技术角度来讲，Urchin 日志处理引擎在报告目录中为其当前正在处理的配置文件创建了一个 lock.udb 文件。这样，可以在处理过程中将此配置文件锁定，以确保在任何指定时间该配置文件仅运行一个日志处理引擎实例。启动时，日志处理引擎会检查是否存在 lock.udb 文件。如果该文件存在，日志处理引擎会查阅当前的锁定。如果找不到该文件，则表明配置文件上一次运行失败，因此日志处理引擎会试图在配置文件的数据库中回滚到上一次已知的良好状态，然后再继续运行。如上所述，如果回滚存档不存在，则系统会显示回滚错误消息并终止日志处理。 <p class="line867"><strong>补救措施</strong> <p class="line874">由于 Urchin 在上一次运行时异常终止，因此正在处理的当月的 Urchin 数据库处于未知的状态，该数据库中包含的数据也未设置正确的检查点。所以，需要删除正在处理的当月的所有数据。大多数情况下，该月的最终 Urchin 数据是在出现故障的那次进程中创建的，因此不会存在正确的数据。 <p class="line874">请通过以下过程重置 Urchin 配置文件数据并继续运行相应的配置文件： <p class="line867"><span class="u">Windows Systems</span> <ol type="1"><li><p class="line862">启动 DOS Shell（开始 -&gt; 运行 -&gt;"cmd"） </li><li>将目录更改为存放 Urchin 配置文件数据的文件夹，通常为 <ul><li style="list-style-type:none">C:\Program Files\Urchin\data\reports\profilename </li></ul></li><li>通过"TYPE lock.udb"命令查看 lock.udb 文件的内容。应有一行或多行 YYYYMM 格式的日期条目，如 200408。 </li><li>对于 lock.udb 文件中的每一 YYYYMM 行，执行以下步骤： <ul><li>通过"DEL YYYYMM-*data*"命令删除相应的 Urchin 月度数据库 </li><li>通过"DIR YYYYMM*backup*.zip"命令检查相应月份是否存在备份存档。此备份存档的命名格式为 YYYYMM-backup-YYYYMMDDHHMMSS.zip，如 200805-backup-20080331103340.zip。 </li><li>如果该月存在一个或多个备份文件，则通过"..\..\..\util\unzip -o -u backupfile.zip"命令从具有最新时间戳的备份存档中恢复数据，如"..\..\..\util\unzip -o -u 200805-backup-20080331103340.zip" </li></ul></li><li>通过"DEL lock.udb"命令删除 lock.udb 文件 </li><li>现在，可以用"立即运行"按钮重新运行配置文件 </li></ol><p class="line867"><span class="u">UNIX 类型的系统</span> <ol type="1"><li>以"根用户"或 Urchin 运行时所用的用户身份启动一个命令行界面 </li><li>将目录更改为存放 Urchin 配置文件数据的位置，例如 <ul><li style="list-style-type:none">"cd /usr/local/urchin/data/reports/profilename" </li></ul></li><li>通过"cat lock.udb"命令查看 lock.udb 文件的内容。应有一行或多行 YYYYMM 格式的日期条目，如 200803。 </li><li>对于 lock.udb 中的每一 YYYYMM 行，执行以下步骤： <ul><li>通过"rm YYYYMM-*data*"命令删除相应的 Urchin 月度数据库 </li><li>通过以下命令检查相应月份是否存在备份存档： <ul><li style="list-style-type:none">"ls YYYYMM*backup*.zip"。 此备份存档的命名格式为 YYYYMM-backup-YYYYMMDDHHMMSS.zip，如 200803-backup-20080331103340.zip。 </li></ul></li><li>如果该月存在一个或多个备份文件，则通过"../../../util/unzip -o -u backupfile.zip"命令从具有最新时间戳的备份存档中恢复数据，如"../../../util/unzip -o -u 200803-backup-20080331103340.zip" </li></ul></li><li>通过"rm lock.udb"命令删除 lock.udb 文件 </li><li>现在，可以用"立即运行"按钮重新运行配置文件 </li></ol></div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>