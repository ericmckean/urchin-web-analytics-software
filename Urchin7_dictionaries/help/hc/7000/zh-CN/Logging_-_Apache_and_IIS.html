<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>日志记录 - Apache 与 IIS</strong> <p class="line867"><strong>概述</strong> <p class="line874">请务必以 Urchin 能正确解读数据并生成全面详细的报告的格式来设置您的网络服务器日志记录系统。本文将说明常见网络服务器 Apache 与 Microsoft IIS 的设置程序。要获得最深入的报告，一定要启用包含"推介链接"及"用户代理程序"信息的日志。要在使用"Urchin 跟踪模块 (UTM)"时启用唯一身份访问者报告，还需另外启用 Cookie 日志记录。基于 UTM 的跟踪是获得真实唯一身份访问者报告的唯一途径。虽然并非必要，但我们建议您在更改网络服务器日志记录系统之前，先决定是否使用 UTM。若决定使用，应立即在日志中启用 Cookie。如果您启用了 Cookie 但没有立即在网站上安装 UTM，也不会有什么问题。操作之前，可浏览"访问者跟踪"部分，以熟悉 UTM 安装过程。 <p class="line867"><strong>配置</strong> <p class="line867"><strong>Apache</strong> <p class="line874">默认情况下，Apache 通常会以通用日志格式进行日志记录，不过也会提供选项供用户以较为详细的格式进行日志记录（称为 NCSA 扩展/组合日志格式）。要获得效果最佳的报告，Urchin 需要 NCSA 扩展/组合格式的变体。要配置 Apache 以使用适当的格式，请按照下列步骤操作： <p class="line874">1. 创建 httpd.conf 文件的备份。然后用文本编辑器打开初始的 httpd.conf。 <p class="line862">2. 找到包含以 LogFormat 开头的行的部分。 <p class="line862">3. 使用下面的其中一种表单插入新的 LogFormat 行，使用哪一种表单则取决于您是否要使用 UTM。LogFormat 条目必须以单行的形式添加到您的配置文件，不可包含回车符或分行符。请确保正确输入所有字符。 <p class="line867"><strong>针对不使用 UTM 的网站：</strong> <p class="line867"><tt>LogFormat&nbsp;"%h&nbsp;%v&nbsp;%u&nbsp;%t&nbsp;\"%r\"&nbsp;%&gt;s&nbsp;%b&nbsp;\"%{Referer}i\"&nbsp;\"%{User-Agent}i\""&nbsp;urchin</tt> <p class="line867"><strong>针对 UTM-enabled 网站：</strong> <p class="line867"><tt>LogFormat&nbsp;"%h&nbsp;%v&nbsp;%u&nbsp;%t&nbsp;\"%r\"&nbsp;%&gt;s&nbsp;%b&nbsp;\"%{Referer}i\"&nbsp;\"%{User-Agent}i\"&nbsp;\"%{Cookie}i\""&nbsp;urchin</tt> <p class="line862">4. LogFormat 行结尾的"urchin"是为了将此格式应用于日志文件而在 httpd.conf 内其他位置使用的昵称。此字符串可任选。使用"urchin"有助于标识为了适应 Urchin 处理程序而创建的这一条目。 <p class="line862">5. 检查您希望启用这一新日志记录格式的 &lt;VirtualHost&gt; 条目。停用 &lt;VirtualHost&gt;&lt;/VirtualHost&gt; 组中任何现有的 TransferLog 或 CustomLog 条目，方法是在条目前插入 #（例如：将 TransferLog 改成 #TransferLog）。然后插入以下 CustomLog 新条目，请用指向日志位置的适当路径替换 path_to_log 字符串。 <p class="line867"><tt>CustomLog&nbsp;path_to_log/access.log&nbsp;urchin</tt> <p class="line862">如果您以前选择了"urchin"之外的标识符作为 LogFormat 条目的昵称，请用该昵称替换 CustomLog 条目内的"urchin"。 <p class="line874">6. 将修改内容保存到您的 httpd.conf 文件。 <p class="line862">7. <strong>重要提示！</strong> 运行以下命令来检查新 httpd.conf 的语法： <p class="line867"><tt>apachectl&nbsp;configtest</tt> <p class="line874">这样做应该会生成语法正确的响应。如果响应不正确，请仔细检查 httpd.conf 文件并修复错误。如果无法获得正确响应，请不要继续进行。此时请创建已修改文件的备份，然后用您在程序开始时保存的 httpd.conf 副本覆盖目前的版本，以恢复源文件。这样做能确保网络服务器继续正常工作，直到您找出更改中的错误为止。 <p class="line874">8. 确认 httpd.conf 的语法后，请重新启动 Apache。首选方法是调用 apachectl 脚本，该脚本通常与 Apache 一并安装。 <p class="line867"><tt>apachectl&nbsp;restart</tt> <p class="line862">9. 检查日志记录。打开浏览器并点击相关网站数次。然后检查 CustomLog 条目中所指定日志文件的最后几行。您应该会看见最近的几次点击已写入日志。 <p class="line874">针对 Urchin 修改的扩展/组合日志格式，日志行看起来类似以下示例： <p class="line867"><tt class="backtick">64.40.51.27</tt> <tt class="backtick">www.urchin.com</tt> <tt class="backtick">-</tt> <tt class="backtick">[28/Aug/2002:15:11:01</tt> <tt class="backtick">-0700]</tt> <tt class="backtick">"GET</tt> <tt class="backtick">/images/urchin_header_logo.gif</tt> <tt class="backtick">HTTP/1.1"</tt> <tt class="backtick">200</tt> <tt class="backtick">3017</tt> <tt class="backtick">"http://www.urchin.com/"</tt> <tt class="backtick">"Mozilla/4.0</tt> <tt class="backtick">(compatible;</tt> <tt class="backtick">MSIE</tt> <tt class="backtick">6.0;</tt> <tt class="backtick">Windows</tt> <tt class="backtick">NT</tt> <tt class="backtick">5.0)"</tt> <p class="line874">如果您的网站上已经配置 UTM，并打开了 Cookie 日志记录，则日志行看起来类似以下示例： <p class="line867"><tt class="backtick">64.40.51.27</tt> <tt class="backtick">www.urchin.com</tt> <tt class="backtick">-</tt> <tt class="backtick">[28/Aug/2002:15:11:01</tt> <tt class="backtick">-0700]</tt> <tt class="backtick">"GET</tt> <tt class="backtick">/images/urchin_header_logo.gif</tt> <tt class="backtick">HTTP/1.1"</tt> <tt class="backtick">200</tt> <tt class="backtick">3017</tt> <tt class="backtick">"http://www.urchin.com/"</tt> <tt class="backtick">"Mozilla/4.0</tt> <tt class="backtick">compatible;</tt> <tt class="backtick">MSIE</tt> <tt class="backtick">6.0;</tt> <tt class="backtick">Windows</tt> <tt class="backtick">NT</tt> <tt class="backtick">5.0)"</tt> <tt class="backtick">"__utma=171060324.1378004559.1063331913.1063334677.1063521838.3;</tt> <tt class="backtick">__utmb=171060324;</tt> <tt class="backtick">__utmc=171060324"</tt> <p class="line874">10. 请注意行结尾处额外的 UTM Cookie 信息。 <p class="line867"><strong>Microsoft Internet Information Server (IIS)</strong> <p class="line874">请注意：Microsoft IIS 使用 W3C 日志记录格式。 <p class="line874">如果您的 IIS 日志文件至少包含以下字段，则 Urchin 可以提供非常基本的报告： <ul><li>日期 </li><li>时间 </li><li>C-IP </li><li>CS-URI-Stem </li><li>SC-Status </li><li>SC-Bytes </li></ul><p class="line874">这些字段为必填字段。若没有这些字段，您就无法获得有意义的报告。不过，这一最低限度的日志记录无法为推介链接与浏览器报告提供足够信息。因此，建议您为 IIS 服务器设置更详细的日志记录属性。 <p class="line874">IIS 日志记录属性既可针对服务器上的各个域分别配置，也可一并配置所有域。针对域较多的服务器，建议您采用全局选项。下列步骤能确保记录必填的日志文件字段。如果您选择记录其他字段，Urchin 处理时会直接略过。但是，记录不必要的字段会增加日志文件的大小，因此最好只记录 Urchin 所需的字段。 <p class="line862">1. 要启用 IIS 服务管理工具，请前往"开始"-&gt;"程序"-&gt;"管理工具"-&gt;"计算机管理"。 <p class="line874">2. 展开"服务和应用程序"树，然后选择"Internet信息服务"，即会出现网站列表（Windows 2003 服务器除外，使用此版本时需要再展开"网站"文件夹，才能获得网站列表）。 <p class="line874">3. 右键点击希望修改的网站条目，然后选择"属性"。 <p class="line874">4. 选择"网站"标签，然后确认已选中此屏幕底部的"启用日志记录"复选框。接着，请从"活动日志格式"下拉菜单中，选择"W3C 扩展日志文件格式"。 <p class="line874">5. 点击"活动日志格式"框旁的"属性"按钮。 <p class="line874">6. 选择"扩展属性"标签。 <p class="line874">7. 请选中下列字段的框： <ul><li>日期 [ date] </li><li>时间 [ time ] </li><li>客户 IP 地址 [ c-ip ] </li><li>用户名 [ cs-username ] </li><li>方法 [ cs-method ] </li><li>URI 主干 [ cs-uri-stem ] </li><li>URI 查询 [ cs-uri-query ] </li><li>协议状态 [ sc-status ] </li><li>发送的字节数 [ sc-bytes ] </li><li>用户代理程序 [ cs[User-Agent] ] </li><li>引荐网址 [ cs[Referer] ] </li><li>Cookie [ cs[Cookie] ]（只有 UTM 跟踪需要此字段） </li></ul><p class="line874">8. 应确认未选中"进程记帐"框，因为其无法提供实用的网络访问活动信息。 <p class="line874">9. 在各窗口中选择 Apply 与"确定"，以保存您的设置。 <p class="line874">10. 无需重新启动 IIS。系统应该会根据新的设置立即开始日志记录。 </div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>