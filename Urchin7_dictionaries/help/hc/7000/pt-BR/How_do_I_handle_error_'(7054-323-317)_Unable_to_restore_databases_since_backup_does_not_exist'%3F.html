<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><table id="top_location_line" width="100%"><table id="top_location_line" width="100%"><tr width="100%"><td><a href="http://www.urchin.com"><img border="0" src="../images/google_sm.gif" width="135" height="41"></a></td><td width="100%"><span id="top_line" style="width: 100%; float: left; clear: both; border-bottom: 1px solid #CCC;"><span id="top_title" style="float: left; margin-top: 10px;"><b>Help Center</b></span></td></tr></table>
<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en">
<p class="line867"><strong>Como faço para lidar com o erro '(7054-323-317) Impossível restaurar bancos de dados porque o backup não existe'?</strong> <p class="line867"><strong>Descrição do problema</strong> <p class="line874">Ao executar um perfil do Urchin, você recebe as seguintes mensagens: <p class="line874">(7050-323-317) Starting automatic rollback + <p class="line874">(7054-323 317) Unable to restore databases since backup does not exist. <p class="line867"><strong>Causa</strong> <p class="line874">O erro pode ocorrer quando uma execução anterior desse Perfil do Urchin tiver sido finalizada de maneira anormal.Isso poderá ocorrer se o processo ou a tarefa do 'mecanismo de processamento de registros' tiver sido manualmente finalizado pelo administrador do sistema (a partir da CLI do console, etc.), se tiver ocorrido outro problema inesperado que possa ter finalizado um processamento de registro em andamento, ou ainda talvez a um processo de reinicialização do sistema que não tenha sido concluído corretamente. <p class="line874">Por via de regra, o Urchin é capaz de se recuperar normalmente de uma finalização anormal ao reverter para o último estado satisfatório conhecido do Perfil em questão. Entretanto, se o processamento do perfil tiver sido finalizado na primeira execução desse perfil (ou na primeira execução de um determinado mês), não haverá um arquivo de backup para reversão.Nesse ponto, o Urchin emite o erro "Impossível restaurar bancos de dados". <p class="line874">Em um nível mais técnico, o mecanismo de processamento de registros do Urchin cria um arquivo lock.udb no diretório apropriado, referente ao perfil que está atualmente processando.Ele mantém esse arquivo bloqueado durante o processamento para garantir que apenas uma instância do mecanismo de processamento de registros possa ser executada para o perfil em um determinado momento.Na ocasião da inicialização, o mecanismo de processamento de registros verifica a existência do arquivo lock.udb.Se o arquivo estiver presente, esse mecanismo verificará se existem bloqueios.Se nenhum bloqueio for detectado, significa que a execução anterior do perfil falhou e, sendo assim, o mecanismo de processamento de registros tentará reverter os bancos de dados do perfil para o último estado satisfatório conhecido antes de continuar.Conforme mencionado anteriormente, se o arquivamento de reversão não existir, as mensagens de erro de reversão serão geradas e o processamento do registro será finalizado. <p class="line867"><strong>Solução</strong> <p class="line874">Devido ao fato de que a execução anterior do Urchin foi finalizada de maneira anormal, os bancos de dados do Urchin referentes ao mês do processamento estão em um estado desconhecido, e os dados neles contidos não foram devidamente verificados.Por isso, será necessário remover os dados do mês inteiro que está sendo processado.Na maioria dos casos, os únicos dados do Urchin para o mês serão aqueles que foram criados durante a execução de processamento com falha e, sendo assim, não existem dados válidos de qualquer maneira. <p class="line874">Use o procedimento a seguir para redefinir os dados de perfil do Urchin e poder continuar a executar o perfil: <p class="line867"><span class="u">Windows Systems</span> <ol type="1"><li><p class="line862">Inicie um Shell do DOS (Iniciar -&gt; Executar -&gt; "cmd"). </li><li>Mude de diretório e acesse a pasta na qual os dados de perfil do Urchin estão armazenados, em geral <ul><li style="list-style-type:none">C:\Program Files\Urchin\data\reports\profilename </li></ul></li><li>Visualize o conteúdo do arquivo lock.udb com o comando "TYPE lock.udb".Deve haver uma ou mais linhas formadas por entradas de data YYYYMM; por exemplo, 200408. </li><li>Para cada linha YYYYMM no arquivo lock.udb, realize as etapas a seguir: <ul><li>Remova os bancos de dados do Urchin mensais correspondentes com o comando "DEL YYYYMM-*data*". </li><li>Verifique se existe um arquivo de backup para o mês correspondente, usando o comando "DIR YYYYMM*backup*.zip".Os arquivos de backup são nomeados como YYYYMM-backup-YYYYMMDDHHMMSS.zip; por exemplo, 200805-backup-20080331103340.zip. </li><li>Se houver um ou mais arquivos de backup para esse mês, restaure os dados do arquivo de backup com o carimbo de data e hora mais atual, usando o comando "..\..\..\util\unzip -o -u backupfile.zip"; por exemplo, "..\..\..\util\unzip -o -u 200805-backup-20080331103340.zip". </li></ul></li><li>Remova o arquivo lock.udb com o comando "DEL lock.udb". </li><li>Agora, é possível executar novamente o perfil com o botão "Executar agora". </li></ol><p class="line867"><span class="u">Sistemas UNIX</span> <ol type="1"><li>Inicie um shell de comando como "root" ou o usuário usado pelo Urchin para execução. </li><li>Mude de diretório e acesse o local onde os dados de perfil do Urchin estão sendo mantidos; por exemplo. <ul><li style="list-style-type:none">"cd /usr/local/urchin/data/reports/profilename" </li></ul></li><li>Visualize o conteúdo do arquivo lock.udb com o comando "cat lock.udb".Deve haver uma ou mais linhas formadas por entradas de data YYYYMM; por exemplo, 200803. </li><li>Para cada linha YYYYMM no arquivo lock.udb, realize as etapas a seguir: <ul><li>Remova os bancos de dados do Urchin mensais correspondentes com o comando "rm YYYYMM-*data*". </li><li>Verifique se existe um arquivo de backup para o mês correspondente, usando o comando <ul><li style="list-style-type:none">"ls YYYYMM*backup*.zip". Os arquivos de backup são nomeados como YYYYMM-backup-YYYYMMDDHHMMSS.zip; por exemplo, 200803-backup-20080331103340.zip. </li></ul></li><li>Se houver um ou mais arquivos de backup para esse mês, restaure os dados do arquivo de backup com o carimbo de data e hora mais atual, usando o comando "../../../util/unzip -o -u backupfile.zip"; por exemplo, "../../../util/unzip -o -u 200803-backup-20080331103340.zip". </li></ul></li><li>Remova o arquivo lock.udb com o comando "rm lock.udb". </li><li>Agora, é possível executar novamente o perfil com o botão "Executar agora". </li></ol></div><div id="pagebottom"></div>
</div>


<div id="footer" style="clear: both; margin: 0; padding: 0; border-bottom:1px solid #CCC;"></div><div id="copyright" style="font-size: 70%; text-align: center;">&copy;2010 Google</div>
</body></html>