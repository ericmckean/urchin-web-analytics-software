## Please edit system and help pages ONLY in the moinmaster wiki! For more
## information, please see MoinMaster:MoinPagesEditorGroup.
##acl MoinPagesEditorGroup:read,write,delete,revert All:read
##master-page:HelpTemplate
##master-date:Unknown-Date
#format wiki
#language en
'''Использование существующего веб-сервера IIS (на платформах Windows)'''

По умолчанию для администрирования систем Urchin и создания отчетов используется автономный сервер Apache, поставляемый в комплекте с продуктом Urchin. В большинстве случаев этот способ является предпочтительным для реализации интерфейсов администрирования и создания отчетов Urchin. Тем не менее, иногда необходимо задействовать уже установленный сервер IIS. Например, если требуется избежать использования на сервере веб-продуктов сторонних производителей или настроить службу создания отчетов Urchin в качестве виртуального хоста на существующем сервере IIS.

'''ОТКАЗ ОТ ОБЯЗАТЕЛЬСТВ. Обратите внимание, что такие модификации системы Urchin не поддерживаются.'''

'''Последовательность действий'''

'''Примечание.''' Подразумевается, что программа Urchin установлена в каталоге по умолчанию (C:\Program Files\Urchin). В противном случае в приведенных ниже примерах нужно использовать соответствующий каталог.

Шаг 1. Добавьте пользователя веб-интерфейса Urchin.

  * В Windows выберите "Администрирование" -> "Управление компьютером".
  * В левой части открывшегося окна выберите "Локальные пользователи и группы".
  * Правой кнопкой мыши нажмите на папку "Пользователи" и выберите "Новый пользователь...".
  * В поле "Пользователь:" введите "IUSR\_URCHIN".
  * Снимите флажок "Потребовать смену пароля при следующем входе в систему".
  * Установите флажок "Запретить смену пароля пользователем".
  * Нажмите "Создать", затем "Закрыть".
  * Дважды нажмите на папку "Пользователи" в левой части окна.
  * Правой кнопкой мыши нажмите на запись IUSR\_URCHIN в правой части окна и выберите "Свойства".
  * На вкладке "Членство в группах" удалите все имеющиеся записи, нажмите кнопку "Добавить..", во всплывающем окне выберите "Гости", снова нажмите "Добавить", затем "OK".
  * Нажмите "Применить" и "Закрыть", чтобы сохранить изменения.
Шаг 2. Установите Urchin (если это еще не сделано).

Шаг 3. Отключите веб-сервер Apache программы Urchin.

  1. В Windows выберите "Администрирование" -> "Службы".
  1. В списке "Службы" найдите запись "Urchin Webserver".
  1. Нажмите на нее правой кнопкой мыши и выберите "Стоп".
  1. Снова нажмите правой кнопкой мыши на запись "Urchin Webserver" и выберите "Свойства", затем поменяйте "Тип запуска" на "Отключено".
  1. Нажмите кнопку "ОК".
Шаг 4. Добавьте новый веб-сайт в IIS. Выберите "Администрирование" -> "Диспетчер служб IIS".

  1. Правой кнопкой мыши нажмите "Веб-узлы".
  1. В поле "Описание:" введите "Urchin" и нажмите "Далее".
  1. Выберите IP-адрес и номер порта (обычно 9999), затем нажмите "Далее".
  1. В поле "Путь:" укажите каталог установки Urchin (по умолчанию C:\Program Files\Urchin\htdocs), затем нажмите "Далее".
  1. Установите флажок "Выполнение:", затем нажмите "Далее" и "Готово".
  1. Правой кнопкой мыши нажмите на новый веб-сайт Urchin и выберите "Свойства":
    1. Снимите флажок "Вести журнал" на вкладке "Веб-узел".
    1. Перейдите на вкладку "Корневой каталог" и установите флажок "Доступ к тексту сценария".
    1. На вкладке "Документы" удалите обе записи по умолчанию, затем нажмите "Добавить", во всплывающем окне введите "session.cgi" и нажмите "ОК".
    1. Перейдите на вкладку "Безопасность каталога", затем нажмите кнопку "Изменить" в области "Управление доступом и проверка подлинности". Установите флажок "Анонимный доступ", затем нажмите кнопку "Изменить..." и укажите "учетную запись для анонимного доступа". Во всплывающем окне в качестве имени пользователя выберите "IUSR\_URCHIN". Два раза нажмите кнопку "ОК", чтобы вернуться в окно "Свойства".
    1. Чтобы сохранить изменения и закрыть окно "Свойства", снова нажмите "ОК".
Шаг 5. Настройте разрешения каталогов. 1. Правой кнопкой мыши нажмите "Пуск" и выберите "Проводник".

  1. Откройте каталог установки Urchin (по умолчанию C:\Program Files\Urchin).
  1. Правой кнопкой мыши нажмите на папку "Urchin" и выберите "Свойства".
  1. Перейдите на вкладку "Безопасность".
  1. Нажмите кнопку "Дополнительно". Снимите флажок "Переносить наследуемые от родительского объекта разрешения на этот объект" и нажмите "Удалить" во всплывающем окне.
  1. Нажмите "Добавить", выберите пользователя "Администратор", затем еще раз нажмите "Добавить".
  1. Нажмите "Добавить", выберите IUSR\_URCHIN, затем еще раз нажмите "Добавить".
  1. В поле "Имя:" удалите все записи, кроме IUSR\_URCHIN и "Администратор".
  1. Предоставьте разрешения на запись для папки 

<urchin\_home>

\var.
  1. Вернитесь на вкладку "Безопасность" (окно "Свойства") и убедитесь, что пользователю IUSR\_URCHIN предоставлены следующие разрешения:
    * чтение и выполнение;
    * список содержимого папки;
    * чтение.
> > . Примечание. Для SYSTEM должны быть установлены все разрешения по умолчанию.
  1. Нажмите "ОК", чтобы сохранить разрешения.
  1. Откройте папку "Urchin" в проводнике Windows.
  1. Правой кнопкой мыши нажмите на папку "data" и выберите "Свойства".
  1. Перейдите на вкладку "Безопасность".
  1. Нажмите кнопку "Дополнительно". Снимите флажок "Переносить наследуемые от родительского объекта разрешения на этот объект" и нажмите "Удалить" во всплывающем окне.
  1. Нажмите "Добавить", выберите пользователя "Администратор", затем еще раз нажмите "Добавить".
  1. Нажмите "Добавить", выберите IUSR\_URCHIN, затем еще раз нажмите "Добавить".
  1. В поле "Имя:" удалите все записи, кроме IUSR\_URCHIN и "Администратор".
  1. Вернитесь на вкладку "Безопасность" (окно "Свойства") и убедитесь, что пользователям "Администратор" и IUSR\_URCHIN предоставлены следующие разрешения:
    * полный доступ;
    * изменение;
    * чтение и выполнение;
    * список содержимого папки;
    * чтение;
    * запись.
  1. Нажмите кнопку "ОК".
Шаг 6. Только для IIS 6. Откройте "Диспетчер расширений веб-службы".

  1. Нажмите 'Добавить новое расширение веб-службы'.
  1. В поле "Имя расширения:" введите "Urchin CGI".
  1. Нажмите 'Добавить'.
  1. Найдите файлы report.cgi и session.cgi, затем выделите их. По умолчанию отображаются только файлы **.dll, поэтому нужно изменить фильтр на "Все файлы".
    * Каталог по умолчанию: C:\Program Files\Urchin\htdocs.
  1. Установите флажок "Установить состояние расширения как "Разрешено".
  1. Нажмите кнопку "ОК".
  1. Перейдите к основной записи IIS для вашего сервера: "Имя узла".
  1. Нажмите на нее правой кнопкой мыши и выберите "Свойства".
  1. Выберите "Типы MIME".
  1. Нажмите "Создать".
  1. В поле "Расширение:" введите ".cgi".
  1. В поле "Тип MIME" введите "application/octet-stream".
  1. Нажмите кнопку "ОК".
  1. Нажмите кнопку "ОК".
Теперь ваш веб-сервер IIS будет вызывать веб-интерфейс Urchin при переходе по ссылке http://my.server.com:port, где "port" – выбранный при установке Urchin порт (по умолчанию – 9999).**

'''Использование существующего веб-сервера IIS для веб-служб API данных Urchin(Urchin 6.6+)'''

В комплекте с веб-службами API данных Urchin (Urchin 6.6+) поставляется модуль IIS, с помощью которого можно обрабатывать запросы к API данных Urchin. Инструкции по настройке API данных для веб-сервера IIS см. в разделе ["Можно ли интегрировать API данных Urchin с IIS?"].