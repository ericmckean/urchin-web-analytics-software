## Please edit system and help pages ONLY in the moinmaster wiki! For more
## information, please see MoinMaster:MoinPagesEditorGroup.
##acl MoinPagesEditorGroup:read,write,delete,revert All:read
##master-page:HelpTemplate
##master-date:Unknown-Date
#format wiki
#language en
'''Настройки баз данных отчетности Urchin'''

(Последнее обновление: 16 декабря 2008 г.)

'''Обзор'''

Для управления масштабируемостью и точностью баз данных отчетности в Urchin используются два описанных ниже параметра.

'''Предел таблицы БД'''

Этот параметр позволяет упростить работу с данными крупных сайтов. Используйте его, чтобы ограничить количество записей в одной таблице базы данных отчетности Urchin. В большинстве случаев можно использовать заданное по умолчанию значение этого параметра. Если в определенный месяц количество записей в таблице превышает установленный предел, все записи сверх предельного количества объединяются в последней строке под названием ''Другие''. Таким образом, чем больше размер таблицы, тем точнее отчетные данные.

Если в отчете Urchin большая часть элементов сгруппирована в строке '''Другие''', необходимо увеличить предел таблицы БД, чтобы обеспечить точность данных.

'''Максимальное использование памяти'''

Этот параметр Urchin позволяет указать максимальный размер базы данных отчетности в памяти компьютера, то есть ограничить объем памяти, выделяемый на обработку журналов. При работе с крупными сайтами разумно увеличить значение этого параметра. Это повысит производительность системы, поскольку подкачка страниц будет требоваться реже. Значение этого параметра по умолчанию довольно мало, однако его легко можно увеличить при наличии достаточного объема физической памяти в системе.

'''Экспериментальные настройки'''

В настоящее время в Urchin поддерживаются следующие максимальные значения настроек баз данных отчетности:

Предел таблицы БД:                <= 500 000 записей

Максимальное использование памяти:      <= 1024 МБ

В Urchin 6.5 и более поздних версиях могут поддерживаться расширенные значения этих настроек, однако эта возможность предназначена только для''' опытных пользователей Urchin'''. Эти расширенные значения не отображаются в интерфейсе администрирования; их можно задать только через базу данных конфигурации. В Urchin 6.5 поддерживаются следующие максимальные значения расширенных настроек баз данных отчетности:

Предел таблицы БД:                <= 2 000 000 записей

Максимальное использование памяти:      <= 2 ГБ ''' '''

'''Руководство по использованию экспериментальных настроек'''

> . Поскольку эти расширенные настройки доступны в экспериментальном режиме, а их применение в некоторых системах может привести к ошибкам, связанным с '''нехваткой памяти''', перед их использованием настоятельно рекомендуем вам ознакомиться со следующими сведениями и рекомендациями.
  * Обычно на каждое 32-разрядное приложение выделяется 4 ГБ виртуального адресного пространства, которое делится между пользовательским адресным пространством и адресным пространством ядра. Пользовательский процесс может использовать память только в пользовательском адресном пространстве.
  * '''''Платформа Windows:''''' пользовательское приложение может использовать только 2 ГБ, оставшиеся 2 ГБ выделяются для ядра. Хотя ОС Windows позволяет увеличивать пользовательское пространство до 3 ГБ с помощью функции [4GT](http://msdn.microsoft.com/en-us/library/bb613473(VS.85).aspx), процессы Urchin не используют эту возможность и всегда занимают максимум 2 ГБ. Таким образом, при использовании ОС Windows пользователь не может установить предел таблицы БД более '''500 000''' записей и максимальное использование памяти более '''1 ГБ'''.
    * Чтобы обеспечить максимальную ''производительность'', задайте следующие настройки:
      * Максимальное использование памяти:  '''1024 МБ'''
      * Предел таблицы БД:  '''500 000''' строк таблицы базы данных
    * Чтобы обеспечить максимальную ''точность'', задайте следующие настройки:
      * Максимальное использование памяти:  '''256''' МБ
      * Предел таблицы БД:  '''1 000 000''' строк таблицы базы данных
  * '''''Платформы UNIX:''''''''''' пользовательское приложение может использовать только 3 ГБ, оставшийся 1 ГБ выделяется для ядра. Таким образом, при использовании платформы UNIX пользователь не может установить предел таблицы БД более '''500 000''' записей и максимальное использование памяти более '''2 ГБ'''.
    * Чтобы обеспечить максимальную ''производительность'', задайте следующие настройки:
      * Максимальное использование памяти:  '''2048''' МБ
      * Предел таблицы БД:  '''500 000''' строк таблицы базы данных
    * Чтобы обеспечить максимальную ''точность'', задайте следующие настройки:
      * Максимальное использование памяти:  '''1024''' МБ
      * Предел таблицы БД:  '''2 000 000''' строк таблицы базы данных
'''Конфигурация ''''''расширенного 'предела таблицы БД''''''' '''

Как и в случае с обычным значением 'предела таблицы БД', эти расширенные значения можно задать как для индивидуальных профилей, так и в качестве глобальных настроек. При использовании следующего запроса предел таблицы БД будет установлен равным 1 000 000 записей для профиля, если идентификатор профиля – '1'.

```
UPDATE uprofiles SET uipr_db_table_limit=1000000 WHERE uspr_id=1;
```
При использовании следующего запроса общий предел таблицы БД будет установлен равным 1 000 000 записей. Это значение будет использовано для всех профилей, у которых в поле uipr\_db\_table\_limit задано значение "0".

```
UPDATE uglobals SET uigl_db_table_limit=1000000 WHERE ucgl_name='Global Settings';
```
'''Конфигурация расширенного 'максимального использования памяти''''''' '''

Максимальное использование памяти можно изменить только на глобальном уровне.

Это значение будет автоматически использовано для всех профилей, в которых для параметра "Использование памяти БД" установлено значение 'Ограничить системой кэширования' или в поле базы данных 'ubpr\_limit\_db\_cache\_size' задано значение 1.

При использовании следующего запроса общее максимальное использование системы будет установлено равным 2 ГБ. Обратите внимание, что поле базы данных воспринимает значение в 'мегабайтах' (то есть значение 512 будет восприниматься как 512 МБ).

```
UPDATE uglobals SET uigl_db_cache_size=2048 WHERE ucgl_name='Global Settings';
```