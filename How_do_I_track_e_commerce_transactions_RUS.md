## Please edit system and help pages ONLY in the moinmaster wiki! For more
## information, please see MoinMaster:MoinPagesEditorGroup.
##acl MoinPagesEditorGroup:read,write,delete,revert All:read
##master-page:HelpTemplate
##master-date:Unknown-Date
#format wiki
#language en
'''Как отслеживать транзакции электронной торговли?'''

> ''Статья предоставлена компанией'' [:ivantageLimited:ivantage Limited]'', авторизованным консультантом по программному обеспечению Urchin''

Для отслеживания транзакций электронной торговли Urchin использует технологию сбора данных на стороне клиента. Если добавить простой код на страницу квитанции, Urchin будет автоматически обнаруживать и регистрировать информацию о транзакциях и товарах. Необходимая информация размещается в скрытой форме, которая анализируется для получения данных о продуктах и транзакциях. Большинство систем электронной торговли на основе шаблонов можно изменить таким образом, чтобы эта информация указывалась в скрытом виде в квитанции.

'''Включение отслеживания транзакций электронной торговли'''

Для начала отслеживания транзакций электронной торговли необходимо включить функцию создания отчетов по электронной торговле в выбранном профиле. Для этого выполните следующие действия:

  1. Войдите в Urchin.
> 2. Нажмите "Изменить" рядом с профилем, который необходимо включить.
> 3. На странице "Настройки профиля" нажмите "Изменить" в разделе "Основная информация профиля веб-сайта".
> 4. Установите переключатель "Веб-сайт электронной торговли", выбрав вместо "Нет" значение "Да".

'''Формат страницы квитанции'''

Затем необходимо убедиться, что на странице квитанции правильно размещен код отслеживания. Это можно сделать с помощью драйвера "Включить" на стороне сервера или другого драйвера на основе шаблона. Также можно просто вставить код в исходный HTML сайта вручную:
```
   <script src="/urchin.js" type="text/javascript">
   </script>
```
Затем в любом месте квитанции под кодом отслеживания следует добавить следующие строки с помощью своей системы. Весь приведенный в скобках текст необходимо заменить на фактические значения, как описано в разделе "Справка о параметрах" ниже.
```
   <form style="display:none;" name="utmform">
   <textarea id="utmtrans">UTM:T|[order-id]|[affiliation]|
   [total]|[tax]| [shipping]|[city]|[state]|[country] UTM:I|[order-id]|[sku/code]|[productname]|[category]|[price]|
   [quantity] </textarea>
   </form>
```
Затем необходимо вызвать функцию utmSetTrans после отправки формы. Это обеспечит регистрацию данных о транзакции. Для этого легче всего вставить событие body onLoad в открывающий тег 

&lt;body&gt;

:
```
   <body onLoad="javascript:__utmSetTrans()">
```
Если вы не можете изменить тег body, можно вызвать функцию utmSetTrans в отдельном теге скрипта. При этом важно сделать так, чтобы функция вызывалась после отправки формы:
```
   <script type="text/javascript">
   __utmSetTrans();
   </script>
```
ВНИМАНИЕ! При определении значений для формы не используйте квадратные скобки. Кроме того, не используйте запятые в качестве разделителей в полях итоговой суммы, налогов и стоимости доставки; все знаки после запятой будут проигнорированы.

'''Пример'''
```
UTM:T|34535|Main Store|111108.06|8467.06|10.00|San Diego|CA|USA
UTM:I|34535|XF-1024|Urchin T-Shirt|Shirts|11399.00|9
UTM:I|34535|CU-3424|Urchin Drink Holder|Accessories|20.00|2
```
В скрытой форме заданы строки двух типов: строки транзакций и позиций. Для каждой транзакции необходимо задать только одну строку транзакции, которая будет обозначена с помощью "T" непосредственно за "UTM:". В этой строке указывается общая сумма транзакции, включая все налоги и стоимость доставки, а также другая информация. Для каждого элемента в квитанции необходимо создать позицию, которая определяется с помощью "I". В этих строках могут указываться названия товаров, коды, цена за единицу товаров и количество товаров. Никаких ограничений на количество строк элементов для одной транзакции нет.

'''Справка о параметрах'''


'''Переменные в строке транзакции'''
```
[order-id]      Внутренний уникальный идентификатор заказа
[affiliation]   Название партнерской организации или отделения магазина (необязательно)
[total]         Общая сумма транзакции в рублях
[tax]   Сумма налога для транзакции
[shipping]      Стоимость доставки для транзакции
[city]  Город, с которым необходимо связать транзакцию
[state/region]  Регион или область
[country]       Страна
```

'''Переменные строки позиции'''
```
[order-id]      Внутренний уникальный идентификатор заказа (должен совпадать со значением в строке транзакции)
[sku/code]      Код единицы складского хранения продукта
[product name]  Название или описание продукта
[category]      Категория или вариант товара
[price]         Стоимость одной единицы товара
[quantity]      Заказанное количество
```