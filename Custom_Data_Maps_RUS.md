## Please edit system and help pages ONLY in the moinmaster wiki! For more
## information, please see MoinMaster:MoinPagesEditorGroup.
##acl MoinPagesEditorGroup:read,write,delete,revert All:read
##master-page:HelpTemplate
##master-date:Unknown-Date
#format wiki
#language en
'''Пользовательские карты данных'''

Карты данных представляют собой наборы таблиц, которые используются для хранения данных, полученных из файлов журнала. Предустановленные таблицы:

  * T – итого;
  * TR – транзакции;
  * H – гистограмма;
  * V – посетители;
  * 1-n – предустановленные сводные таблицы, описанные в файле карты данных.


Набор таблиц по умолчанию хранится в файле 

&lt;Urchin&gt;

/lib/reporting/profiletypes/Default/datamap.dm2.  Для таблиц используется следующий формат.
  * Каждое вхождение в таблице занимает одну строку и должно содержать следующие поля: TABLE AFIELD BFIELD CFIELD DFIELD EFIELD REQUIREMENTS SPECIAL IFIELDS PPFIELDS.
  * В столбцах не должно быть пробелов.
  * Столбцы отделяются друг от друга одним или несколькими пробелами.
  * Если значение не определено (пусто), вместо него следует указать знак '-'.

  * TABLE – уникальный идентификатор таблицы, максимальное значение: 200.
  * AFIELD-EFIELD – поля строк из файла 

&lt;Urchin&gt;

/lib/reporting/logformats/fieldlist.txt.
  * Поле REQUIREMENTS описывает, какие поля (A–E) должны присутствовать в обращении, чтобы оно могло быть занесено в таблицу (выполняет функцию ограничения первичного ключа).
Например, предположим, что в таблице T1 требуется поле A, в поле A указывается "IP-адрес" (cfield=4), а обращение не содержит IP-адреса. В результате обращение будет пропущено и не попадет в таблицу T1. Однако, если в другой таблице, T2, указывается "IP-адрес", но поле REQUIREMENT не содержит A, обращение попадет в таблицу T2.
  * SPECIAL – используется для связи записей из сводной таблицы с записями из внутренних таблиц (сеансы, посетители, транзакции, единицы транзакции, пути); выполняет функцию внешнего ключа. Например, таблица 1 из карты данных по умолчанию связывает источник, канал и кампанию с сеансом (первичным ключом является "источник"), таблица 2 связывает источник, канал, запрос и содержание с сеансом (первичный ключ – "источник"), а таблица 12 связывает основу запроса и заголовок страницы с путями. Не рекомендуется вносить в таблицы какие-либо изменения с помощью специальных флагов или иным образом использовать флаги в пользовательских таблицах, поскольку это может нарушить работу внешних ключей.
    * 1-S11 – связь с сеансом
    * 1 – связь с путем
    * ARAM – специальный параметр
    * 1-T2 – связь с транзакцией
    * 0 - I1 – связь с товарной единицей
    * PATH – исходный путь
    * THRU – переход к цели
    * PATH – обратный путь к цели
    * THRU – переход

  * IFIELDS – показатели. В таблицах хранится готовый набор показателей для оптимизации скорости извлечения данных. Таким образом, при обработке журналов система выполняет все необходимые расчеты для каждой комбинации показателей (или полей cfield), чтобы пропустить этот этап при извлечении данных. Пример. Поля cfield: IP-адрес; поля ifield: посещения. В ходе обработки создается новая таблица для хранения предварительно подсчитанных посещений для каждого IP-адреса. Отчет, встроенный в верхнюю часть таблицы, извлекает данные практически мгновенно, без каких-либо дополнительных вычислений. Допустимые значения для столбца IFIELDS описаны ниже.

  * PPFIELDS – постобработка полей (в диапазоне полей ifield). Данные для полей, подлежащих постобработке, определяются на основе записей о сеансе и связанных с ним записей о пути, транзакции и товарной единице. Использовать поля ppfield в пользовательском отчете не рекомендуется.


Чтобы создать запись пользовательской карты данных, создайте новую строку, следуя приведенным выше инструкциям.  Чтобы карта данных работала без ошибок, убедитесь, что для каждой новой записи в таблице используется уникальное число.

Пример строки в файле карты данных:

|'''TABLE''' | '''AFIELD''' | '''BFIELD''' | '''CFIELD''' | '''DFIELD''' | '''EFIELD''' | '''REQUIREMENTS''' | '''SPECIAL''' | '''IFIELDS''' | '''PPFIELDS'''|
|:-----------|:-------------|:-------------|:-------------|:-------------|:-------------|:-------------------|:--------------|:--------------|:--------------|
|1 | 139 | 138 | 137| -| -| A| S1 |5,11,15,19,24,25,26,27,28,29,30,31 | -|
|Номер таблицы | Поле A из используемой записи | Поле B из используемой записи |Поле C из используемой записи |Поле D не используется | Поле E не используется | Только поле A должно содержать данные | Связь с сеансом 1 | Вычисляемые поля |Полей для постобработки нет|



Вычисляемые поля, которые используются для столбца IFIELDS:
  1. Обращения
> 2. Действительные обращения
> 3. Ошибочные обращения
> 4. Байты
> 5. Страницы
> 6. Не страницы
> 7. Страницы входа
> 8. Страницы выхода
> 9. Страницы отказа
  1. . Время на странице
  1. . Посещения
  1. . Посетители
  1. . Новые посетители
  1. . Предыдущие посетители
  1. . Транзакции
  1. . Клиенты
  1. . Новые клиенты
  1. . Предыдущие клиенты
  1. . Доход
> 20. Налог
> 21. Доставка
> 22. Единицы товара
> 23. Доход на единицу товара
> 24. Отклики
> 25. Показы
> 26. Клики
> 27. Стоимость
> 28. Цели 1
> 29. Цели 2
> 30. Цели 3
> 31. Цели 4
> 32. Начальные шаги к цели 1
> 33. Начальные шаги к цели 2
> 34. Начальные шаги к цели 3
> 35. Начальные шаги к цели 4
> 36. Итог