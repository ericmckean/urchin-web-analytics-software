## Please edit system and help pages ONLY in the moinmaster wiki! For more
## information, please see MoinMaster:MoinPagesEditorGroup.
##acl MoinPagesEditorGroup:read,write,delete,revert All:read
##master-page:HelpTemplate
##master-date:Unknown-Date
#format wiki
#language en
'''Пользовательские форматы журнала'''


'''Введение'''

Urchin обрабатывает файлы журнала практически любого формата. Если предоставить Urchin всю необходимую информацию о формате журнала, программа выполнит синтаксический анализ необработанных данных в соответствии с конфигурацией. В настоящей статье подробно описывается метод создания пользовательских форматов журнала. После создания пользовательского формата его можно будет выбрать в интерфейсе администрирования в качестве формата для любого файла журнала.

Следует отметить, что для создания некоторых отчетов требуются определенные данные журнала. Необходимо удостовериться, что ваш журнал содержит все требуемые поля для обработки программой Urchin. Если вы не уверены, так ли это, см. документ "Файлы журнала" – "Ведение журнала" – "Другие веб-серверы" в разделе "Администрирование Urchin" Центра документации.

'''Создание пользовательских форматов журнала'''

Создайте файл спецификации форматов в папке
```
   urchin install dir]/lib/custom/logformats/
```
. В качестве образца можно использовать файл под названием 'custom.lf'. Вы можете создать сразу несколько пользовательских файлов. Чтобы программа Urchin могла распознать их, эти файлы должны иметь расширение '.lf'. Встроенные форматы журнала, используемые по умолчанию (например, apache, w3c, netscape и другие), находятся в папке
```
   urchin install dir]/lib/reporting/logformats/
```
В каждом из упомянутых выше каталогов в файле fieldlist.txt имеется список доступных полей. В пользовательской папке находится список пользовательских полей, а в папке отчетности – список стандартных полей. Пользовательские форматы журнала могут относиться к полям в любом из этих списков благодаря использованию числовых идентификаторов. После создания пользовательского формата он станет доступен для выбора в интерфейсе администрирования. Далее описывается процесс создания пользовательского формата.

'''Шаг 1. Скопируйте пример.'''
В каталоге 'lib/custom/logformats' папки установки Urchin создайте копию файла 'custom.lf'. В новом имени файла не должно быть пробелов, а сам он должен иметь расширение '.lf'.

'''Шаг 2. Установите первичные позиции.'''
Отредактируйте файл, созданный на шаге 1. Этот файл содержит много полезной информации о каждой переменной. Прежде всего необходимо установить переменную `PrimaryPositions`. Этот список, разделенный запятыми, определяет по числовому идентификатору каждое поле в формате журнала, а также его относительную позицию. Идентификаторы полей можно посмотреть в файлах fieldlist.txt, которые находятся в двух упомянутых выше папках. Если ваши форматы даты и времени отличаются от Apache и IIS, используйте поля 16 и 17 соответственно. Если и дата, и время указываются в одном поле, используйте только поле 16.

'''Шаг 3. Выберите разделитель полей.'''
Выберите переменную `FieldSeparator1` и установите разделитель полей. Используйте \s для пробела и \t – для табуляции.

'''Шаг 4. Доступно ли поле статуса HTTP?'''
Если поле статуса HTTP доступно, оставьте для переменной `StatusRequired` значение YES (ДА). Это позволит отличать действительные обращения от ошибочных. Если статус в журнале не предусмотрен, установите значение NO (НЕТ), чтобы действительными считались все обращения.

'''Шаг 5. Вы используете собственный формат даты/времени?'''
В таком случае измените значение `CustomDateFormat` для поля 16 и`CustomTimeFormat` для поля 17. Формат указывается с помощью переменных %, определенных в ["пользовательских форматах даты/времени"].

'''Шаг 6. Выберите другие переменные.'''
Большинство других переменных также можно использовать для пользовательских форматов журнала, однако сначала прочитайте в файле комментарии к каждой переменной, чтобы понять, подходит ли она в вашем случае.

'''Шаг 7. Имеются ли у вас пользовательские вычисляемые поля?'''
Помимо формата в файле спецификации можно также указать пользовательские вычисляемые поля. В нижней части файла приводится пример с комментариями. Пользовательское вычисляемое поле работает по тому же принципу, что и расширенный фильтр (см. раздел о фильтрации), за исключением того, что вычисляемые поля обрабатываются первыми. Дополнительную информацию см. в статье о пользовательских вычисляемых полях.

После того как вы сохраните файл, его можно будет назначить в качестве формата для файла журнала в интерфейсе администрирования. Он автоматически появится в раскрывающемся меню форматов журнала.