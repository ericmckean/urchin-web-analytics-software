## Please edit system and help pages ONLY in the moinmaster wiki! For more
## information, please see MoinMaster:MoinPagesEditorGroup.
##acl MoinPagesEditorGroup:read,write,delete,revert All:read
##master-page:HelpTemplate
##master-date:Unknown-Date
#format wiki
#language en
'''Как перенести Urchin 6.x со всеми отчетными данными на другой сервер?'''

Для переноса Urchin 6.x на другой сервер необходимо выполнить следующие действия:

  1. Подготовьте базу данных Urchin
  1. Установите Urchin 6.x на новый сервер.
  1. Перенесите базы данных отчетности Urchin для профилей.
  1. Перенесите пользовательские файлы и шаблоны.
  1. Примените пользовательские настройки Urchin.
  1. Проверьте новые разрешения для файлов.
  1. Повторно активируйте лицензию Urchin.
Примечание. Следующие инструкции также применимы в случае межплатформенных переносов. Файлы базы данных отчетности Urchin можно перенести на любую операционную систему, которую поддерживает ПО Urchin. При переносе данных и файлов на другой тип платформы следует в том числе учитывать синтаксис командной строки (например, добавление './' для систем Unix). Также следует помнить об изменениях в синтаксисе каталога, например 'Standard\Windows\folders\' вместо '/standard/unix/directories/.'.

'''1. Подготовьте базу данных Urchin'''

Этот шаг можно пропустить, если вы хотите использовать для установки ту же самую базу данных Urchin. В противном случае перед установкой на новый сервер базу данных Urchin необходимо подготовить:

'''а.'''      Создайте пустую базу данных Urchin со всеми необходимыми разрешениями для пользователя Urchin.

Примерные команды SQL для создания серверной базы данных MySQL:

```
   mysql> create database urchin character set utf8;
   mysql> GRANT ALL ON urchin.* to 'urchin'@'localhost' IDENTIFIED BY 'urchinpassword';
```
Примерные команды PSQL для создания серверной базы данных PostreSQL:

```
   postgres=# CREATE DATABASE urchin WITH ENCODING 'UTF8';
   postgres=# CREATE USER urchin WITH PASSWORD 'urchin password';
   postgres=# GRANT ALL ON DATABASE urchin TO urchin;
   postgres=# \connect urchin;
   postgres=# CREATE LANGUAGE 'PLPGSQL';
```
'''б.'''      Скопируйте содержимое базы данных Urchin со старого сервера, создав дамп SQL старой базы данных и импортировав его в новую. При этом будет скопировано большинство нужных настроек Urchin, в том числе профили, источники журналов, пользователи, аккаунты, группы, планировщик и другие.

Ниже приведены примерные команды SQL для создания серверной базы данных MySQL:

> . Исходная БД:
```
   mysqldump –h {oldDBhostname} –u {username} –p {urchinDBname} > urchin.sql
```
> . Целевая БД:
```
   mysql –h {newDBhostname} –u {username} –p {urchinDBname} < urchin.sql
```
Ниже приведены примерные команды PSQL для создания серверной базы данных PostreSQL:

> . Исходная БД:
```
   pg_dump -h {oldDBhostname} -p {oldDBport} -U {username} {urchinDBname} > urchin.sql
```
> . Целевая БД:
```
   psql –h {newDBhostname} –p {newDBport} -U {username} {urchinDBname} < urchin.sql
```
'''2. Установите Urchin 6 на новый сервер'''

Создайте на новом сервере папку установки Urchin 6, используя подготовленную до этого базу данных.

(Не забудьте снять флажок "Удалить и заново создать таблицы базы данных Urchin, если таковые имеются" при установке в Windows или же выберите ответ "НЕТ" на вопрос “Инициализировать базу данных конфигурации во время установки?” в Unix.)

Подробные инструкции по установке Urchin можно найти здесь (пропустите шаги по конфигурированию базы данных и сразу же переходите к главе "Установка Urchin"):

  * ["Руководство по установке Urchin (FreeBSD и Linux)"]
  * ["Руководство по установке Urchin (Windows)"]
Остановите выполнение демонов или служб Urchin, прежде чем переходить к следующим шагам:

```
~/urchin/bin/urchinctl -stop
```
'''3. Перенесите базы данных отчетности Urchin для профилей'''

По умолчанию все отчетные данные Urchin хранятся в подкаталоге главного каталога Urchin: ~/urchin/data/. Этот каталог необходимо архивировать, сохранив структуру подкаталогов, а затем, после установки Urchin, перенести на новый сервер. По возможности его лучше восстановить на новом сервере в том же местоположении: ~/urchin/data.

Примечание. Если в старой папке установки Urchin использовались собственные каталоги для истории и отчетов, эти каталоги должны быть скопированы (вместо ~/urchin/data/reports и ~/urchin/data/history).

'''4. Перенесите пользовательские файлы и шаблоны'''

Настройки, внесенные в Urchin пользователем, в том числе форматы журнала и наборы отчетов, не сохраняются в каталоге "data" программы Urchin. Они хранятся отдельно, в каталоге "lib" папки установки Urchin. При установке Urchin на новый сервер все изменения, внесенные в старую систему Urchin, необходимо скопировать в новую папку установки Urchin. Обычно эти файлы хранятся по адресу ~/urchin/lib/custom/.

Для этого зайдите на старый сервер Urchin и перейдите в каталог "lib" папки установки Urchin. Затем создайте архив каталога "custom" (и всех его подкаталогов), используя утилиту архивирования (например, tar или ZIP). Скопируйте этот архив на новый сервер Urchin и распакуйте его в каталог "lib" папки установки Urchin.

'''5. Примените пользовательские настройки Urchin'''

Вы могли изменить настройки по умолчанию для старой папки установки Urchin 6.x в следующих файлах:

```
/etc/session.conf
/etc/urchin.conf
/var/urchinwebd.conf
```
В этом случае на забудьте применить те же настройки к новой папке установки, отредактировав соответствующие файлы.

'''6. Проверьте новые разрешения для файлов'''

После переноса файлов на новый сервер следует выполнить тщательную проверку, чтобы удостовериться, что у всех них имеются необходимые разрешения и что все файлы принадлежат одному и тому же пользователю (только для UNIX-подобных систем).

Чтобы исправить разрешения Urchin, в каталоге ~/urchin/util/ выполните следующую команду:

```
        inspector -r
```
Для проверки принадлежности файлов (только для UNIX) выполните следующую команду в каталоге ~/urchin/:

```
        chown -R urchin_user:urchin_group ./
```
'''7. Повторно активируйте лицензию Urchin'''

Запустите демоны или службы Urchin.

```
~/urchin/bin/urchinctl start
```
По завершении установки Urchin откройте веб-интерфейс Urchin.

В системе должен отображаться экран “Лицензия Urchin” со ссылкой “Повторно активировать лицензию”:

Поскольку программа Urchin была установлена с использованием подготовленной заранее базы данных, ключ системы изменился, и поэтому лицензию необходимо повторно активировать.

Примечание. Попросите своего поставщика Urchin сбросить лицензию перед повторной активацией.